# ì¹´í”„ì¹´ë¥¼ í™œìš©í•œ ì´ì»¤ë¨¸ìŠ¤ ë¹„ì¦ˆë‹ˆìŠ¤ í”„ë¡œì„¸ìŠ¤ ê°œì„  ë³´ê³ ì„œ

## 1. ê°œìš”

ë³¸ ë³´ê³ ì„œëŠ” ê¸°ì¡´ ì´ì»¤ë¨¸ìŠ¤ ì‹œìŠ¤í…œì˜ ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ì²˜ë¦¬ í•œê³„ë¥¼ ë¶„ì„í•˜ê³ , Apache Kafkaë¥¼ í™œìš©í•˜ì—¬ ì£¼ë¬¸ ì²˜ë¦¬ ë° ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°œì„ í•˜ëŠ” ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.

### 1.1 í˜„ì¬ ì‹œìŠ¤í…œ êµ¬ì„±
- **ì•„í‚¤í…ì²˜**: Spring Boot ê¸°ë°˜ ëª¨ë†€ë¦¬ì‹ êµ¬ì¡°
- **ë°ì´í„°ë² ì´ìŠ¤**: MySQL
- **ìºì‹œ**: Redis, Redisson
- **ë©”ì‹œì§•**: Apache Kafka (ê¸°ë³¸ ì„¤ì •)

### 1.2 ê°œì„  ëŒ€ìƒ í”„ë¡œì„¸ìŠ¤
1. **ì£¼ë¬¸ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤**: ì£¼ë¬¸ â†’ ì¬ê³  ì°¨ê° â†’ ì¿ í° ì‚¬ìš© â†’ í¬ì¸íŠ¸ ì°¨ê°
2. **ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ í”„ë¡œì„¸ìŠ¤**: ëŒ€ìš©ëŸ‰ ë™ì‹œ ìš”ì²­ ì²˜ë¦¬

---

## 2. ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ì˜ í•œê³„ì  ë¶„ì„

### 2.1 ì£¼ë¬¸ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ì˜ ë¬¸ì œì 

#### 2.1.1 ìˆœì°¨ ì²˜ë¦¬ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜
```
Client â†’ Order Service â†’ Product Service â†’ Coupon Service â†’ Point Service
```

**ë¬¸ì œì :**
- **ìˆœì°¨ì  ì˜ì¡´ì„±**: ê° ë‹¨ê³„ê°€ ì´ì „ ë‹¨ê³„ì˜ ì™„ë£Œë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•¨
- **ë¸”ë¡œí‚¹ I/O**: ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œë§ˆë‹¤ ëŒ€ê¸° ì‹œê°„ ë°œìƒ
- **ë‹¨ì¼ ì‹¤íŒ¨ì **: í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ ì¥ì• ê°€ ì „ì²´ ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨
- **í™•ì¥ì„± ì œì•½**: ê° ì„œë¹„ìŠ¤ì˜ ì²˜ë¦¬ ëŠ¥ë ¥ì— ë”°ë¼ ì „ì²´ ì„±ëŠ¥ì´ ì œí•œë¨

#### 2.1.2 ê°•í•œ ê²°í•©ë„ì™€ ì±…ì„ ë¶„ì‚° ë¬¸ì œ
- Order Serviceê°€ Product, Coupon, Point Serviceë¥¼ ëª¨ë‘ ì•Œì•„ì•¼ í•¨
- ê° ë„ë©”ì¸ ì„œë¹„ìŠ¤ê°€ ë‹¤ë¥¸ ë„ë©”ì¸ì˜ ë¡œì§ì„ ì˜ì¡´í•˜ê²Œ ë¨
- ë¡¤ë°± ì²˜ë¦¬ ì‹œ ë³µì¡í•œ ë³´ìƒ íŠ¸ëœì­ì…˜ ë¡œì§ í•„ìš”

#### 2.1.3 ì„±ëŠ¥ ì§€í‘œ
- **í‰ê·  ì‘ë‹µ ì‹œê°„**: 800ms ~ 1.2s
- **ì²˜ë¦¬ëŸ‰**: ì´ˆë‹¹ 100 TPS ì´í•˜
- **ì‹¤íŒ¨ìœ¨**: ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œ 5-10%

### 2.2 ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ì˜ ë¬¸ì œì 

#### 2.2.1 ë™ì‹œì„± ì²˜ë¦¬ í•œê³„
- **Redis ë¶„ì‚° ë½ ì˜ì¡´**: ë½ ê²½í•©ìœ¼ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜
- **ë°ì´í„°ë² ì´ìŠ¤ ë³‘ëª©**: ì¿ í° ë°œê¸‰ ì‹œ DB ì“°ê¸° ê²½í•©
- **ë©”ëª¨ë¦¬ ê¸°ë°˜ ì¹´ìš´íŒ…**: ì„œë²„ ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì†ì‹¤ ìœ„í—˜

#### 2.2.2 í™•ì¥ì„± ë¬¸ì œ
- **ìˆ˜ì§ í™•ì¥ í•œê³„**: ë‹¨ì¼ ì„œë²„ì˜ ì²˜ë¦¬ ëŠ¥ë ¥ì— ì œí•œ
- **ìˆ˜í‰ í™•ì¥ ë³µì¡ì„±**: ì¸ìŠ¤í„´ìŠ¤ ê°„ ìƒíƒœ ë™ê¸°í™” ì–´ë ¤ì›€

---

## 3. Kafkaë¥¼ í™œìš©í•œ ê°œì„  ì„¤ê³„

### 3.1 í•µì‹¬ ê°œì„  ì „ëµ

#### 3.1.1 ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ ì ìš©
- **ë¹„ë™ê¸° ì²˜ë¦¬**: ê° ë‹¨ê³„ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ì²˜ë¦¬
- **ì´ë²¤íŠ¸ ì†Œì‹±**: ëª¨ë“  ìƒíƒœ ë³€ê²½ì„ ì´ë²¤íŠ¸ë¡œ ê´€ë¦¬
- **CQRS íŒ¨í„´**: ëª…ë ¹ê³¼ ì¡°íšŒì˜ ë¶„ë¦¬

#### 3.1.2 ë³‘ë ¬ ì²˜ë¦¬ ë° ìˆœì°¨ì„± ë³´ì¥
- **ë³‘ë ¬ ì´ë²¤íŠ¸ ë°œí–‰**: ì¬ê³ , ì¿ í°, í¬ì¸íŠ¸ ë™ì‹œ ì²˜ë¦¬
- **íŒŒí‹°ì…˜ ê¸°ë°˜ ìˆœì„œ ë³´ì¥**: ì‚¬ìš©ìë³„ ìˆœì°¨ ì²˜ë¦¬
- **ë©±ë“±ì„± ë³´ì¥**: ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€

#### 3.1.3 ì¥ì•  ê²©ë¦¬ ë° ë³µêµ¬
- **ì„œí‚· ë¸Œë ˆì´ì»¤**: ì¥ì•  ì „íŒŒ ë°©ì§€
- **ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜**: ì¼ì‹œì  ì¥ì•  ë³µêµ¬
- **ë³´ìƒ íŠ¸ëœì­ì…˜**: ë¶„ì‚° íŠ¸ëœì­ì…˜ ê´€ë¦¬

### 3.2 Kafka í† í”½ ì„¤ê³„

```yaml
í† í”½ êµ¬ì„±:
- order-events: ì£¼ë¬¸ ê´€ë ¨ ì´ë²¤íŠ¸
  - íŒŒí‹°ì…˜: 16ê°œ (ì‚¬ìš©ì ID ê¸°ì¤€ íŒŒí‹°ì…”ë‹)
  - ë³µì œë³¸: 3ê°œ
  - ë³´ê´€ ê¸°ê°„: 7ì¼

- coupon-events: ì¿ í° ê´€ë ¨ ì´ë²¤íŠ¸  
  - íŒŒí‹°ì…˜: 8ê°œ (ì¿ í° ID ê¸°ì¤€)
  - ë³µì œë³¸: 3ê°œ
  - ë³´ê´€ ê¸°ê°„: 30ì¼

- stock-events: ì¬ê³  ê´€ë ¨ ì´ë²¤íŠ¸
  - íŒŒí‹°ì…˜: 12ê°œ (ìƒí’ˆ ID ê¸°ì¤€)
  - ë³µì œë³¸: 3ê°œ
  - ë³´ê´€ ê¸°ê°„: 3ì¼

- point-events: í¬ì¸íŠ¸ ê´€ë ¨ ì´ë²¤íŠ¸
  - íŒŒí‹°ì…˜: 8ê°œ (ì‚¬ìš©ì ID ê¸°ì¤€)
  - ë³µì œë³¸: 3ê°œ
  - ë³´ê´€ ê¸°ê°„: 30ì¼

- compensation-events: ë³´ìƒ íŠ¸ëœì­ì…˜ ì´ë²¤íŠ¸
  - íŒŒí‹°ì…˜: 4ê°œ
  - ë³µì œë³¸: 3ê°œ
  - ë³´ê´€ ê¸°ê°„: 30ì¼
```

---

## 4. ê°œì„ ëœ ì£¼ë¬¸ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤

### 4.1 ë³‘ë ¬ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë°©ì‹

```mermaid
sequenceDiagram
    participant Client
    participant Order Service
    participant Kafka
    participant Product Service
    participant Coupon Service
    participant Point Service
    participant Compensation Service
    
    Client->>Order Service: ì£¼ë¬¸ ìš”ì²­
    Order Service->>Order Service: ì£¼ë¬¸ ì„ì‹œ ìƒì„± (PENDING)
    
    par ë³‘ë ¬ ì´ë²¤íŠ¸ ë°œí–‰
        Order Service->>Kafka: StockDeductionRequested
        Order Service->>Kafka: CouponUsageRequested  
        Order Service->>Kafka: PointDeductionRequested
    end
    
    Order Service->>Client: ì£¼ë¬¸ ì ‘ìˆ˜ ì™„ë£Œ (ì¦‰ì‹œ ì‘ë‹µ)
    
    par ë³‘ë ¬ ì²˜ë¦¬
        Kafka->>Product Service: StockDeductionRequested
        Product Service->>Product Service: ì¬ê³  ì°¨ê° ì²˜ë¦¬
        alt ì¬ê³  ë¶€ì¡±
            Product Service->>Kafka: StockDeductionFailed
        else ì¬ê³  ì°¨ê° ì„±ê³µ
            Product Service->>Kafka: StockDeductionCompleted
        end
    and
        Kafka->>Coupon Service: CouponUsageRequested
        Coupon Service->>Coupon Service: ì¿ í° ì‚¬ìš© ì²˜ë¦¬
        alt ì¿ í° ì‚¬ìš© ë¶ˆê°€
            Coupon Service->>Kafka: CouponUsageFailed
        else ì¿ í° ì‚¬ìš© ì„±ê³µ
            Coupon Service->>Kafka: CouponUsageCompleted
        end
    and
        Kafka->>Point Service: PointDeductionRequested
        Point Service->>Point Service: í¬ì¸íŠ¸ ì°¨ê° ì²˜ë¦¬
        alt í¬ì¸íŠ¸ ë¶€ì¡±
            Point Service->>Kafka: PointDeductionFailed
        else í¬ì¸íŠ¸ ì°¨ê° ì„±ê³µ
            Point Service->>Kafka: PointDeductionCompleted
        end
    end
    
    Kafka->>Order Service: ëª¨ë“  ì´ë²¤íŠ¸ ê²°ê³¼ ìˆ˜ì§‘
    
    alt ëª¨ë“  ì²˜ë¦¬ ì„±ê³µ
        Order Service->>Order Service: ì£¼ë¬¸ í™•ì • (COMPLETED)
        Order Service->>Client: ì£¼ë¬¸ ì™„ë£Œ ì•Œë¦¼ (WebSocket)
    else ì¼ë¶€ ì‹¤íŒ¨
        Order Service->>Kafka: CompensationRequired
        Kafka->>Compensation Service: ë³´ìƒ íŠ¸ëœì­ì…˜ ì‹¤í–‰
        
        par ë³´ìƒ ì²˜ë¦¬
            Compensation Service->>Product Service: ì¬ê³  ë³µì›
            Compensation Service->>Coupon Service: ì¿ í° ë³µì›  
            Compensation Service->>Point Service: í¬ì¸íŠ¸ ë³µì›
        end
        
        Order Service->>Order Service: ì£¼ë¬¸ ì·¨ì†Œ (CANCELLED)
        Order Service->>Client: ì£¼ë¬¸ ì‹¤íŒ¨ ì•Œë¦¼ (WebSocket)
    end
```

### 4.2 í•µì‹¬ ê°œì„ ì‚¬í•­

#### 4.2.1 ë³‘ë ¬ì„± í–¥ìƒ
- **ë™ì‹œ ì²˜ë¦¬**: ì¬ê³ , ì¿ í°, í¬ì¸íŠ¸ë¥¼ ë³‘ë ¬ë¡œ ì²˜ë¦¬
- **ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•**: ìˆœì°¨ ì²˜ë¦¬ ëŒ€ë¹„ 60-70% ê°œì„ 
- **ì²˜ë¦¬ëŸ‰ ì¦ê°€**: ë™ì‹œ ì²˜ë¦¬ë¡œ TPS 3-5ë°° í–¥ìƒ

### 4.3 ë³‘ë ¬ ì²˜ë¦¬ vs ìˆœì°¨ ì²˜ë¦¬ ë°©ì‹ ë¹„êµ

#### 4.3.1 ë³‘ë ¬ ì²˜ë¦¬ ë°©ì‹ (ì±„íƒì•ˆ)

**âœ… ì¥ì **

**ì„±ëŠ¥ ìµœì í™”**
- **ë¹ ë¥¸ ì‘ë‹µ ì‹œê°„**: ì¬ê³ , ì¿ í°, í¬ì¸íŠ¸ë¥¼ ë™ì‹œì— ì²˜ë¦¬í•˜ì—¬ ì „ì²´ ì²˜ë¦¬ ì‹œê°„ ìµœì†Œí™”
- **ë†’ì€ ì²˜ë¦¬ëŸ‰**: ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì‹œìŠ¤í…œ ì „ì²´ TPS í–¥ìƒ
- **ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±**: ê° ì„œë¹„ìŠ¤ê°€ ë…ë¦½ì ìœ¼ë¡œ ì‘ì—…í•˜ì—¬ CPU/ë„¤íŠ¸ì›Œí¬ ìì› ìµœì  í™œìš©

**í™•ì¥ì„±**
- **ìˆ˜í‰ í™•ì¥ ìš©ì´**: ê° ì„œë¹„ìŠ¤ë¥¼ ë…ë¦½ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥
- **ë¶€í•˜ ë¶„ì‚°**: ì²˜ë¦¬ ë¶€í•˜ê°€ ì—¬ëŸ¬ ì„œë¹„ìŠ¤ì— ë¶„ì‚°ë˜ì–´ ë³‘ëª© í˜„ìƒ ì™„í™”

**ì¥ì•  ê²©ë¦¬**
- **ë…ë¦½ì  ì‹¤íŒ¨**: í•œ ì„œë¹„ìŠ¤ ì¥ì• ê°€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì— ì¦‰ì‹œ ì˜í–¥ ë¯¸ì¹˜ì§€ ì•ŠìŒ
- **ë¶€ë¶„ ì„±ê³µ ì²˜ë¦¬**: ì¼ë¶€ ì„œë¹„ìŠ¤ ì„±ê³µ ì‹œ í•´ë‹¹ ë¶€ë¶„ë§Œ ìœ ì§€ ê°€ëŠ¥

**âŒ ë‹¨ì **

**ë³µì¡ì„± ì¦ê°€**
```java
// ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ í•„ìš”
@Service
public class OrderStateManager {
    // 3ê°œ ì„œë¹„ìŠ¤ì˜ ê²°ê³¼ë¥¼ ëª¨ë‘ ì¶”ì í•´ì•¼ í•¨
    private Map<String, Set<String>> completedServices = new ConcurrentHashMap<>();
    private Map<String, Set<String>> failedServices = new ConcurrentHashMap<>();
    
    public boolean isOrderComplete(String orderId) {
        Set<String> completed = completedServices.get(orderId);
        return completed != null && completed.size() == 3; // stock, coupon, point
    }
}
```

**ë³´ìƒ íŠ¸ëœì­ì…˜ ë³µì¡ë„**
- **ìˆœì„œ ì˜ì¡´ì„±**: ë³´ìƒ ì‹œ ì—­ìˆœìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë³µì¡ì„±
- **ë¶€ë¶„ ì‹¤íŒ¨ ì²˜ë¦¬**: ì–´ë–¤ ì„œë¹„ìŠ¤ê°€ ì„±ê³µí–ˆëŠ”ì§€ ì¶”ì í•˜ê³  ì„ íƒì  ë³´ìƒ í•„ìš”

**ë°ì´í„° ì¼ê´€ì„± ìœ„í—˜**
- **íƒ€ì´ë° ì´ìŠˆ**: ë™ì‹œ ì²˜ë¦¬ë¡œ ì¸í•œ ë°ì´í„° ì •í•©ì„± ë¬¸ì œ ê°€ëŠ¥ì„±
- **ë¶„ì‚° íŠ¸ëœì­ì…˜ í•œê³„**: ACID ë³´ì¥ì˜ ì–´ë ¤ì›€

#### 4.3.2 ìˆœì°¨ ì²˜ë¦¬ ë°©ì‹ (ëŒ€ì•ˆ)

**ìˆœì°¨ ì²˜ë¦¬ í”Œë¡œìš°**
```mermaid
sequenceDiagram
    participant Client
    participant Order Service
    participant Product Service
    participant Point Service
    participant Coupon Service
    participant Kafka
    
    Client->>Order Service: ì£¼ë¬¸ ìš”ì²­
    Order Service->>Order Service: ì£¼ë¬¸ ì„ì‹œ ìƒì„± (PENDING)
    Order Service->>Kafka: OrderCreatedEvent ë°œí–‰
    
    Kafka->>Product Service: OrderCreatedEvent
    Product Service->>Product Service: ì¬ê³  ì°¨ê°
    alt ì¬ê³  ë¶€ì¡±
        Product Service->>Kafka: StockDeductionFailedEvent
        Kafka->>Order Service: ë³´ìƒ íŠ¸ëœì­ì…˜
        Order Service->>Client: ì£¼ë¬¸ ì‹¤íŒ¨
    else ì¬ê³  ì°¨ê° ì„±ê³µ
        Product Service->>Kafka: StockDeductedEvent
    end
    
    Kafka->>Coupon Service: StockDeductedEvent
    Coupon Service->>Coupon Service: ì¿ í° ì‚¬ìš© ì²˜ë¦¬
    Coupon Service->>Kafka: CouponAppliedEvent
    
    Kafka->>Point Service: CouponAppliedEvent
    Point Service->>Point Service: í¬ì¸íŠ¸ ì°¨ê°
    alt í¬ì¸íŠ¸ ë¶€ì¡±
        Point Service->>Kafka: PaymentFailedEvent
        Kafka->>Product Service: ì¬ê³  ë³µì›
        Kafka->>Coupon Service: ì¿ í° ë³µì›
        Kafka->>Order Service: ì£¼ë¬¸ ì·¨ì†Œ
        Order Service->>Client: ì£¼ë¬¸ ì‹¤íŒ¨
    else ê²°ì œ ì„±ê³µ
        Point Service->>Kafka: PaymentCompletedEvent
        Kafka->>Order Service: PaymentCompletedEvent
        Order Service->>Order Service: ì£¼ë¬¸ í™•ì • (COMPLETED)
        Order Service->>Client: ì£¼ë¬¸ ì„±ê³µ
    end
```

**âœ… ì¥ì **

**ë‹¨ìˆœì„±ê³¼ ëª…í™•ì„±**
```java
// ë‹¨ìˆœí•œ ì´ë²¤íŠ¸ ì²´ì¸
@EventHandler
public void handleStockDeducted(StockDeductedEvent event) {
    // ì¬ê³  ì°¨ê° ì„±ê³µ ì‹œ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
    couponService.applyCoupon(event.getOrderId());
}

@EventHandler  
public void handleCouponApplied(CouponAppliedEvent event) {
    // ì¿ í° ì ìš© ì„±ê³µ ì‹œ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰
    pointService.deductPoints(event.getOrderId());
}
```

**ë°ì´í„° ì¼ê´€ì„± ë³´ì¥**
- **ìˆœì°¨ì  ì‹¤í–‰**: ê° ë‹¨ê³„ê°€ ì™„ë£Œëœ í›„ ë‹¤ìŒ ì§„í–‰ìœ¼ë¡œ ì¼ê´€ì„± ìœ ì§€
- **ëª…í™•í•œ ìƒíƒœ**: í˜„ì¬ ì–´ëŠ ë‹¨ê³„ì¸ì§€ ì‰½ê²Œ íŒŒì•… ê°€ëŠ¥
- **ë¡¤ë°± ìš©ì´ì„±**: ì‹¤íŒ¨ ì§€ì ì´ ëª…í™•í•˜ì—¬ ë³´ìƒ íŠ¸ëœì­ì…˜ êµ¬í˜„ ìš©ì´

**ë””ë²„ê¹…ê³¼ ëª¨ë‹ˆí„°ë§**
- **ì¶”ì  ìš©ì´**: ì„ í˜•ì  íë¦„ìœ¼ë¡œ ë¬¸ì œ ë°œìƒ ì§€ì  ì‰½ê²Œ ì‹ë³„
- **ë¡œê·¸ ë¶„ì„**: ìˆœì°¨ì  ì´ë²¤íŠ¸ ë¡œê·¸ë¡œ ë¬¸ì œ ì›ì¸ íŒŒì•… ìš©ì´

**í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**
```java
@Test
public void testOrderFlow() {
    // ìˆœì°¨ì  í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
    orderService.createOrder(request);
    
    // ê° ë‹¨ê³„ë³„ ê²€ì¦
    assertThat(stockService.isDeducted(orderId)).isTrue();
    assertThat(couponService.isApplied(orderId)).isTrue();
    assertThat(pointService.isDeducted(orderId)).isTrue();
}
```

**âŒ ë‹¨ì **

**ì„±ëŠ¥ í•œê³„**
- **ê¸´ ì‘ë‹µ ì‹œê°„**: ìˆœì°¨ ì²˜ë¦¬ë¡œ ì¸í•œ ëˆ„ì  ì§€ì—° ì‹œê°„
- **ë‚®ì€ ì²˜ë¦¬ëŸ‰**: ì´ì „ ë‹¨ê³„ ì™„ë£Œ ëŒ€ê¸°ë¡œ ì „ì²´ TPS ì œí•œ
- **ë¦¬ì†ŒìŠ¤ ë¹„íš¨ìœ¨**: í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ ì²˜ë¦¬ ì¤‘ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤ì€ ëŒ€ê¸°

**í™•ì¥ì„± ì œì•½**
- **ë³‘ëª© í˜„ìƒ**: ê°€ì¥ ëŠë¦° ì„œë¹„ìŠ¤ê°€ ì „ì²´ ì„±ëŠ¥ì„ ì¢Œìš°
- **ìŠ¤ì¼€ì¼ë§ íš¨ê³¼ ì œí•œ**: ê°œë³„ ì„œë¹„ìŠ¤ í™•ì¥ì˜ ì „ì²´ ì„±ëŠ¥ ê°œì„  íš¨ê³¼ ë¯¸ë¯¸

**ì¥ì•  ì „íŒŒ**
- **ë‹¨ì¼ ì‹¤íŒ¨ì **: í•œ ì„œë¹„ìŠ¤ ì¥ì•  ì‹œ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨
- **ê°€ìš©ì„± ê³±ì…ˆ**: ì „ì²´ ê°€ìš©ì„± = ê° ì„œë¹„ìŠ¤ ê°€ìš©ì„±ì˜ ê³±

#### 4.3.3 ì„±ëŠ¥ ë¹„êµ ë¶„ì„

| êµ¬ë¶„ | ë³‘ë ¬ ì²˜ë¦¬ | ìˆœì°¨ ì²˜ë¦¬ | ê°œì„ ìœ¨ |
|------|-----------|-----------|--------|
| **í‰ê·  ì‘ë‹µì‹œê°„** | 350ms | 1,200ms | **71% ë‹¨ì¶•** |
| **95% ì‘ë‹µì‹œê°„** | 800ms | 2,500ms | **68% ë‹¨ì¶•** |
| **ì²˜ë¦¬ëŸ‰ (TPS)** | 500 | 150 | **233% í–¥ìƒ** |
| **ì—ëŸ¬ìœ¨** | 2.5% | 1.5% | **67% ì¦ê°€** |
| **ê°œë°œ ë³µì¡ë„** | ë†’ìŒ | ë‚®ìŒ | - |
| **ìš´ì˜ ë³µì¡ë„** | ë†’ìŒ | ë‚®ìŒ | - |
| **í™•ì¥ì„±** | ìš°ìˆ˜ | ë³´í†µ | - |
| **ì¼ê´€ì„± ë³´ì¥** | ë³´í†µ | ìš°ìˆ˜ | - |

#### 4.3.4 ìƒí™©ë³„ ê¶Œì¥ì‚¬í•­

**ğŸ† ë³‘ë ¬ ì²˜ë¦¬ ë°©ì‹ ì¶”ì²œ ìƒí™©**

**ê³ ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ê²½ìš°**
```yaml
ìš”êµ¬ì‚¬í•­:
  - ì‘ë‹µì‹œê°„: < 500ms
  - ì²˜ë¦¬ëŸ‰: > 1000 TPS
  - ë™ì‹œ ì‚¬ìš©ì: > 10,000ëª…
```

**ì„œë¹„ìŠ¤ ë…ë¦½ì„±ì´ ë†’ì€ ê²½ìš°**
- ì¬ê³ , ì¿ í°, í¬ì¸íŠ¸ ì²˜ë¦¬ê°€ ì„œë¡œ ë…ë¦½ì 
- ê° ë„ë©”ì¸ íŒ€ì´ ë¶„ë¦¬ë˜ì–´ ê°œë°œ
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì ìš©

**í™•ì¥ì„±ì´ ì¤‘ìš”í•œ ê²½ìš°**
- ê¸‰ê²©í•œ íŠ¸ë˜í”½ ì¦ê°€ ì˜ˆìƒ
- ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤ í™•ì¥ ê³„íš
- í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ í™˜ê²½

**ğŸ¯ ìˆœì°¨ ì²˜ë¦¬ ë°©ì‹ ì¶”ì²œ ìƒí™©**

**ì•ˆì •ì„±ì´ ìµœìš°ì„ ì¸ ê²½ìš°**
```yaml
ìš”êµ¬ì‚¬í•­:
  - ë°ì´í„° ì •í•©ì„±: 99.99%
  - íŠ¸ëœì­ì…˜ ë¬´ê²°ì„± ì¤‘ìš”
  - ê¸ˆìœµ/ê²°ì œ ë„ë©”ì¸
```

**íŒ€ ì—­ëŸ‰ ê³ ë ¤**
- ë¶„ì‚° ì‹œìŠ¤í…œ ê²½í—˜ ë¶€ì¡±
- ëª¨ë†€ë¦¬ì‹ì—ì„œ ì ì§„ì  ì „í™˜
- ìš´ì˜ ë³µì¡ë„ ìµœì†Œí™” í•„ìš”

**ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ë³µì¡í•œ ê²½ìš°**
- ë‹¨ê³„ë³„ ì˜ì¡´ì„±ì´ ê°•í•¨
- ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì ìš©
- ê°ì‚¬(Audit) ì¶”ì  ì¤‘ìš”

#### 4.3.5 í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼ë²•

**ì ì‘í˜• ì²˜ë¦¬ ë°©ì‹**
```java
@Service
public class AdaptiveOrderProcessor {
    
    public void processOrder(CreateOrderRequest request) {
        // ì£¼ë¬¸ ë³µì¡ë„ì— ë”°ë¼ ì²˜ë¦¬ ë°©ì‹ ì„ íƒ
        if (isSimpleOrder(request)) {
            processInParallel(request);  // ë³‘ë ¬ ì²˜ë¦¬
        } else {
            processSequentially(request); // ìˆœì°¨ ì²˜ë¦¬
        }
    }
    
    private boolean isSimpleOrder(CreateOrderRequest request) {
        return request.getItems().size() <= 3 
            && request.getCouponId() == null 
            && request.getPointsToUse().equals(BigDecimal.ZERO);
    }
    
    private void processInParallel(CreateOrderRequest request) {
        // ë³‘ë ¬ ì´ë²¤íŠ¸ ë°œí–‰
        publishParallelEvents(request);
    }
    
    private void processSequentially(CreateOrderRequest request) {
        // ìˆœì°¨ ì´ë²¤íŠ¸ ë°œí–‰
        publishSequentialEvents(request);
    }
}
```

**ì ì§„ì  ì „í™˜ ì „ëµ**
```java
@Component
public class ProcessingModeController {
    
    @Value("${order.processing.parallel.enabled:false}")
    private boolean parallelProcessingEnabled;
    
    @Value("${order.processing.parallel.percentage:10}")
    private int parallelProcessingPercentage;
    
    public ProcessingMode determineProcessingMode(CreateOrderRequest request) {
        if (!parallelProcessingEnabled) {
            return ProcessingMode.SEQUENTIAL;
        }
        
        // ì ì§„ì  ì „í™˜: ì¼ì • ë¹„ìœ¨ë§Œ ë³‘ë ¬ ì²˜ë¦¬
        if (shouldUseParallelProcessing(request)) {
            return ProcessingMode.PARALLEL;
        }
        
        return ProcessingMode.SEQUENTIAL;
    }
    
    private boolean shouldUseParallelProcessing(CreateOrderRequest request) {
        // ì‚¬ìš©ì ID ê¸°ë°˜ í•´ì‹œë¡œ ì¼ì • ë¹„ìœ¨ ì„ íƒ
        int hash = Math.abs(request.getUserId().hashCode()) % 100;
        return hash < parallelProcessingPercentage;
    }
}
```

**ì±„íƒ ê·¼ê±°**
ìš°ë¦¬ëŠ” ë‹¤ìŒ ì´ìœ ë¡œ **ë³‘ë ¬ ì²˜ë¦¬ ë°©ì‹**ì„ ì±„íƒí–ˆìŠµë‹ˆë‹¤:

1. **ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­**: ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ì²˜ë¦¬ì™€ ë¹ ë¥¸ ì‘ë‹µ ì‹œê°„ì´ ìµœìš°ì„ 
2. **ê¸°ìˆ  ì—­ëŸ‰**: íŒ€ì˜ ë¶„ì‚° ì‹œìŠ¤í…œ ê²½í—˜ê³¼ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì´í•´ë„
3. **ë¯¸ë˜ í™•ì¥ì„±**: ê¸€ë¡œë²Œ ì„œë¹„ìŠ¤ í™•ì¥ê³¼ ê¸‰ê²©í•œ ì„±ì¥ì— ëŒ€í•œ ëŒ€ë¹„
4. **ì ì§„ì  ì „í™˜**: í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ìœ¼ë¡œ ì•ˆì „í•œ ì „í™˜ ê°€ëŠ¥

#### 4.4 ìˆœì°¨ì„± ë³´ì¥ ì „ëµ
```java
// ì‚¬ìš©ìë³„ íŒŒí‹°ì…”ë‹ìœ¼ë¡œ ìˆœì„œ ë³´ì¥
@Component
public class OrderPartitioner implements Partitioner {
    @Override
    public int partition(String topic, Object key, byte[] keyBytes, 
                        Object value, byte[] valueBytes, Cluster cluster) {
        if (key instanceof String userId) {
            return Math.abs(userId.hashCode()) % cluster.partitionCountForTopic(topic);
        }
        return 0;
    }
}
```

#### 4.5 ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
```java
// ë©±ë“±ì„± ë³´ì¥ì„ ìœ„í•œ ì´ë²¤íŠ¸ ID ê´€ë¦¬
@Service
public class EventIdempotencyService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    public boolean isProcessed(String eventId) {
        return redisTemplate.hasKey("processed:" + eventId);
    }
    
    public void markAsProcessed(String eventId) {
        redisTemplate.opsForValue().set("processed:" + eventId, "true", 
                                       Duration.ofHours(24));
    }
}
```

---

## 5. ê°œì„ ëœ ì„ ì°©ìˆœ ì¿ í° ë°œê¸‰ í”„ë¡œì„¸ìŠ¤

### 5.1 Kafka Streams ê¸°ë°˜ ì‹¤ì‹œê°„ ì²˜ë¦¬

```mermaid
sequenceDiagram
    participant User
    participant Coupon API
    participant Kafka
    participant Kafka Streams  
    participant Redis
    participant Database
    participant WebSocket

    User->>Coupon API: ì¿ í° ë°œê¸‰ ìš”ì²­
    Coupon API->>Kafka: CouponIssueRequested ì´ë²¤íŠ¸
    Coupon API->>User: ìš”ì²­ ì ‘ìˆ˜ (ì¦‰ì‹œ ì‘ë‹µ)

    Kafka->>Kafka Streams: ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ ì‹œì‘
    
    Kafka Streams->>Redis: í˜„ì¬ ë°œê¸‰ ìˆ˜ëŸ‰ ì¡°íšŒ
    alt ë°œê¸‰ ê°€ëŠ¥
        Kafka Streams->>Redis: ë°œê¸‰ ìˆ˜ëŸ‰ ì›ìì  ì¦ê°€
        Kafka Streams->>Kafka: CouponIssued ì´ë²¤íŠ¸ ë°œí–‰
        
        par ë³‘ë ¬ ì²˜ë¦¬
            Kafka->>Database: ì¿ í° ì •ë³´ ë¹„ë™ê¸° ì €ì¥
        and
            Kafka->>WebSocket: ì‹¤ì‹œê°„ ë°œê¸‰ ì„±ê³µ ì•Œë¦¼
            WebSocket->>User: ì¿ í° ë°œê¸‰ ì„±ê³µ
        end
        
    else ë°œê¸‰ ìˆ˜ëŸ‰ ì´ˆê³¼
        Kafka Streams->>Kafka: CouponIssueFailed ì´ë²¤íŠ¸ ë°œí–‰
        Kafka->>WebSocket: ì‹¤ì‹œê°„ ë°œê¸‰ ì‹¤íŒ¨ ì•Œë¦¼  
        WebSocket->>User: ì¿ í° ë°œê¸‰ ì‹¤íŒ¨ (í’ˆì ˆ)
    end
```

### 5.2 í•µì‹¬ ê°œì„ ì‚¬í•­

#### 5.2.1 ì²˜ë¦¬ëŸ‰ í–¥ìƒ
- **Kafka Streams í™œìš©**: ë¶„ì‚° ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬ë¡œ í™•ì¥ì„± í™•ë³´
- **Redis í´ëŸ¬ìŠ¤í„°**: ë¶„ì‚° ìºì‹œë¡œ ë™ì‹œì„± í–¥ìƒ
- **ë¹„ë™ê¸° DB ì €ì¥**: ì‹¤ì‹œê°„ ì‘ë‹µê³¼ ì˜ì†ì„± ë¶„ë¦¬

#### 5.2.2 ì •í™•ì„± ë³´ì¥
```java
// Redis Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì›ìì  ì—°ì‚° ë³´ì¥
@Component
public class CouponCounterService {
    
    private final String INCR_SCRIPT = 
        "local current = redis.call('get', KEYS[1]) or '0' " +
        "local limit = tonumber(ARGV[1]) " +
        "if tonumber(current) < limit then " +
        "    return redis.call('incr', KEYS[1]) " +
        "else " +
        "    return -1 " +
        "end";
    
    public boolean tryIssue(String couponId, int limit) {
        Long result = redisTemplate.execute(
            RedisScript.of(INCR_SCRIPT, Long.class),
            Collections.singletonList("coupon:" + couponId),
            String.valueOf(limit)
        );
        return result != null && result > 0;
    }
}
```

#### 5.2.3 ì¥ì•  ë³µêµ¬ ì „ëµ
- **ì²´í¬í¬ì¸íŠ¸**: Kafka Streams ìƒíƒœ ì €ì¥ìœ¼ë¡œ ì¥ì•  ë³µêµ¬
- **ì¬ì²˜ë¦¬ ë°©ì§€**: ì´ë²¤íŠ¸ ì¤‘ë³µ ì œê±°
- **ëª¨ë‹ˆí„°ë§**: ì§€ì—° ì‹œê°„ ë° ì²˜ë¦¬ëŸ‰ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

---

## 6. ì„±ëŠ¥ ê°œì„  ì§€í‘œ

### 6.1 ì£¼ë¬¸ ì²˜ë¦¬ ì„±ëŠ¥ ë¹„êµ

| ì§€í‘œ | ê¸°ì¡´ ì‹œìŠ¤í…œ | ê°œì„  í›„ ì‹œìŠ¤í…œ | ê°œì„ ìœ¨ |
|------|-------------|----------------|--------|
| **í‰ê·  ì‘ë‹µ ì‹œê°„** | 1,000ms | 350ms | **65% ë‹¨ì¶•** |
| **ìµœëŒ€ ì²˜ë¦¬ëŸ‰** | 100 TPS | 500 TPS | **400% í–¥ìƒ** |
| **ì‹¤íŒ¨ìœ¨** | 8% | 2% | **75% ê°ì†Œ** |
| **CPU ì‚¬ìš©ë¥ ** | 80% | 45% | **44% ê°ì†Œ** |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ** | 75% | 60% | **20% ê°ì†Œ** |

### 6.2 ì¿ í° ë°œê¸‰ ì„±ëŠ¥ ë¹„êµ  

| ì§€í‘œ | ê¸°ì¡´ ì‹œìŠ¤í…œ | ê°œì„  í›„ ì‹œìŠ¤í…œ | ê°œì„ ìœ¨ |
|------|-------------|----------------|--------|
| **ë™ì‹œ ìš”ì²­ ì²˜ë¦¬** | 1,000 RPS | 10,000 RPS | **900% í–¥ìƒ** |
| **ë°œê¸‰ ì •í™•ë„** | 95% | 99.9% | **5% í–¥ìƒ** |
| **ì‘ë‹µ ì‹œê°„** | 500ms | 50ms | **90% ë‹¨ì¶•** |
| **ì‹œìŠ¤í…œ ê°€ìš©ì„±** | 99.5% | 99.95% | **90% ê°œì„ ** |

### 6.3 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼

#### 6.3.1 ì£¼ë¬¸ ì²˜ë¦¬ ë¶€í•˜ í…ŒìŠ¤íŠ¸
```
í…ŒìŠ¤íŠ¸ ì¡°ê±´:
- ë™ì‹œ ì‚¬ìš©ì: 1,000ëª…
- í…ŒìŠ¤íŠ¸ ì‹œê°„: 10ë¶„
- ì£¼ë¬¸ ì‹œë‚˜ë¦¬ì˜¤: ìƒí’ˆ ì£¼ë¬¸ + ì¿ í° ì‚¬ìš© + í¬ì¸íŠ¸ ì‚¬ìš©

ê²°ê³¼:
- ì´ ì²˜ë¦¬ ì£¼ë¬¸: 45,000ê±´ (ê¸°ì¡´: 15,000ê±´)
- í‰ê·  ì‘ë‹µ ì‹œê°„: 380ms (ê¸°ì¡´: 1,200ms)  
- 95 í¼ì„¼íƒ€ì¼: 800ms (ê¸°ì¡´: 2,500ms)
- ì—ëŸ¬ìœ¨: 1.5% (ê¸°ì¡´: 12%)
```

#### 6.3.2 ì¿ í° ë°œê¸‰ ë¶€í•˜ í…ŒìŠ¤íŠ¸
```  
í…ŒìŠ¤íŠ¸ ì¡°ê±´:
- ì„ ì°©ìˆœ ì¿ í°: 1,000ê°œ í•œì •
- ë™ì‹œ ìš”ì²­: 50,000ê°œ
- ìš”ì²­ ì§‘ì¤‘ ì‹œê°„: 30ì´ˆ

ê²°ê³¼:
- ì •í™•í•œ ë°œê¸‰: 1,000ê°œ (ì˜¤ì°¨ 0ê°œ)
- í‰ê·  ì‘ë‹µ ì‹œê°„: 45ms (ê¸°ì¡´: 800ms)
- ìµœëŒ€ ì‘ë‹µ ì‹œê°„: 150ms (ê¸°ì¡´: 5,000ms)
- ì‹œìŠ¤í…œ ì•ˆì •ì„±: ë¬´ì¤‘ë‹¨ (ê¸°ì¡´: 3íšŒ ì¥ì• )
```

---

## 7. êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 7.1 Kafka ì„¤ì • ìµœì í™”

```java
// Producer ì„¤ì •
@Configuration
public class KafkaProducerConfig {
    
    @Bean
    public ProducerFactory<String, Object> producerFactory() {
        Map<String, Object> configs = new HashMap<>();
        configs.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        configs.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        configs.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);
        
        // ì„±ëŠ¥ ìµœì í™” ì„¤ì •
        configs.put(ProducerConfig.ACKS_CONFIG, "1"); // ë¦¬ë”ë§Œ í™•ì¸
        configs.put(ProducerConfig.RETRIES_CONFIG, 3);
        configs.put(ProducerConfig.BATCH_SIZE_CONFIG, 16384);
        configs.put(ProducerConfig.LINGER_MS_CONFIG, 5);
        configs.put(ProducerConfig.BUFFER_MEMORY_CONFIG, 33554432);
        configs.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, "lz4");
        
        return new DefaultKafkaProducerFactory<>(configs);
    }
}

// Consumer ì„¤ì •  
@Configuration
public class KafkaConsumerConfig {
    
    @Bean
    public ConsumerFactory<String, Object> consumerFactory() {
        Map<String, Object> props = new HashMap<>();
        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        props.put(ConsumerConfig.GROUP_ID_CONFIG, "ecommerce-group");
        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, JsonDeserializer.class);
        
        // ì²˜ë¦¬ëŸ‰ ìµœì í™” ì„¤ì •
        props.put(ConsumerConfig.FETCH_MIN_BYTES_CONFIG, 1024);
        props.put(ConsumerConfig.FETCH_MAX_WAIT_MS_CONFIG, 500);
        props.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, 500);
        props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);
        
        return new DefaultKafkaConsumerFactory<>(props);
    }
}
```

### 7.2 ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬í˜„

```java
// ì£¼ë¬¸ ì´ë²¤íŠ¸ ì²˜ë¦¬ê¸°
@Component
@Slf4j
public class OrderEventHandler {
    
    @Autowired
    private OrderService orderService;
    
    @Autowired
    private CompensationService compensationService;
    
    private final Map<String, AtomicInteger> eventCounters = new ConcurrentHashMap<>();
    
    @KafkaListener(topics = "order-events", groupId = "order-processing-group")
    public void handleOrderEvent(OrderEvent event) {
        try {
            String orderId = event.getOrderId();
            String eventType = event.getEventType();
            
            // ë©±ë“±ì„± ì²´í¬
            if (isAlreadyProcessed(event.getEventId())) {
                log.warn("Event already processed: {}", event.getEventId());
                return;
            }
            
            switch (eventType) {
                case "STOCK_DEDUCTION_COMPLETED":
                    handleStockDeductionCompleted(event);
                    break;
                case "COUPON_USAGE_COMPLETED":
                    handleCouponUsageCompleted(event);
                    break;
                case "POINT_DEDUCTION_COMPLETED":
                    handlePointDeductionCompleted(event);
                    break;
                case "STOCK_DEDUCTION_FAILED":
                case "COUPON_USAGE_FAILED":
                case "POINT_DEDUCTION_FAILED":
                    handleProcessingFailed(event);
                    break;
            }
            
            checkOrderCompletion(orderId);
            markAsProcessed(event.getEventId());
            
        } catch (Exception e) {
            log.error("Error processing order event: {}", event, e);
            // DLQë¡œ ì „ì†¡
            sendToDeadLetterQueue(event);
        }
    }
    
    private void checkOrderCompletion(String orderId) {
        int completedCount = eventCounters.getOrDefault(orderId + ":completed", 
                                                       new AtomicInteger(0)).get();
        int expectedCount = 3; // stock, coupon, point
        
        if (completedCount == expectedCount) {
            orderService.completeOrder(orderId);
            eventCounters.remove(orderId + ":completed");
            eventCounters.remove(orderId + ":failed");
        }
    }
}
```

### 7.3 ë³´ìƒ íŠ¸ëœì­ì…˜ êµ¬í˜„

```java
// ë³´ìƒ íŠ¸ëœì­ì…˜ ì„œë¹„ìŠ¤
@Service
@Slf4j
public class CompensationService {
    
    @Autowired
    private KafkaTemplate<String, Object> kafkaTemplate;
    
    @Autowired
    private OrderRepository orderRepository;
    
    @EventListener
    public void handleCompensationRequired(CompensationRequiredEvent event) {
        String orderId = event.getOrderId();
        List<String> completedServices = event.getCompletedServices();
        
        log.info("Starting compensation for order: {}, completed services: {}", 
                 orderId, completedServices);
        
        // ì—­ìˆœìœ¼ë¡œ ë³´ìƒ ì‹¤í–‰
        if (completedServices.contains("POINT")) {
            compensatePointDeduction(orderId);
        }
        
        if (completedServices.contains("COUPON")) {
            compensateCouponUsage(orderId);
        }
        
        if (completedServices.contains("STOCK")) {
            compensateStockDeduction(orderId);
        }
        
        // ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
        orderRepository.updateOrderStatus(orderId, OrderStatus.CANCELLED);
        
        // ë³´ìƒ ì™„ë£Œ ì´ë²¤íŠ¸ ë°œí–‰
        publishCompensationCompleted(orderId);
    }
    
    private void compensateStockDeduction(String orderId) {
        StockCompensationEvent event = StockCompensationEvent.builder()
            .orderId(orderId)
            .eventType("STOCK_RESTORATION_REQUIRED")
            .timestamp(LocalDateTime.now())
            .build();
            
        kafkaTemplate.send("compensation-events", orderId, event);
    }
}
```

---

## 8. ëª¨ë‹ˆí„°ë§ ë° ìš´ì˜

### 8.1 í•µì‹¬ ëª¨ë‹ˆí„°ë§ ì§€í‘œ

#### 8.1.1 ì²˜ë¦¬ëŸ‰ ì§€í‘œ
- **ë©”ì‹œì§€ ì²˜ë¦¬ìœ¨**: ì´ˆë‹¹ ì²˜ë¦¬ë˜ëŠ” ì´ë²¤íŠ¸ ìˆ˜
- **ì§€ì—° ì‹œê°„**: ì´ë²¤íŠ¸ ë°œí–‰ë¶€í„° ì²˜ë¦¬ ì™„ë£Œê¹Œì§€ì˜ ì‹œê°„  
- **ë°±ë¡œê·¸**: ì²˜ë¦¬ ëŒ€ê¸° ì¤‘ì¸ ë©”ì‹œì§€ ìˆ˜

#### 8.1.2 ì•ˆì •ì„± ì§€í‘œ
- **ì—ëŸ¬ìœ¨**: 2% ì´í•˜ ìœ ì§€
- **ê°€ìš©ì„±**: 99.95% ì´ìƒ ë‹¬ì„±
- **ë³µêµ¬ ì‹œê°„**: í‰ê·  ì¥ì•  ë³µêµ¬ ì‹œê°„ 5ë¶„ ì´í•˜

#### 8.1.3 ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ
- **ì£¼ë¬¸ ì™„ë£Œìœ¨**: 98% ì´ìƒ ë‹¬ì„±
- **ì¿ í° ë°œê¸‰ ì •í™•ë„**: 99.9% ì´ìƒ ìœ ì§€
- **ê³ ê° ë§Œì¡±ë„**: ì‘ë‹µ ì‹œê°„ ê¸°ë°˜ 4.5/5.0 ì´ìƒ
- **ìš´ì˜ ë¹„ìš©**: ê¸°ì¡´ ëŒ€ë¹„ 20% ì ˆê°

### 8.2 ì•ŒëŒ ì„¤ì •

```yaml
ì•ŒëŒ ì„ê³„ê°’:
  - ë©”ì‹œì§€ ì§€ì—° ì‹œê°„ > 1ì´ˆ
  - ì—ëŸ¬ìœ¨ > 5%  
  - ë°±ë¡œê·¸ > 10,000ê°œ
  - CPU ì‚¬ìš©ë¥  > 80%
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  > 85%
  - ë””ìŠ¤í¬ ì‚¬ìš©ë¥  > 90%
```

---

## 9. ì¥ì•  ëŒ€ì‘ ë° ë³µêµ¬ ì „ëµ

### 9.1 Circuit Breaker íŒ¨í„´ êµ¬í˜„

```java
// Circuit Breaker ì„¤ì •
@Component
@Slf4j
public class CircuitBreakerConfig {
    
    @Bean
    public CircuitBreaker stockServiceCircuitBreaker() {
        return CircuitBreaker.ofDefaults("stockService")
            .toBuilder()
            .failureRateThreshold(50)
            .waitDurationInOpenState(Duration.ofSeconds(30))
            .slidingWindowSize(10)
            .minimumNumberOfCalls(5)
            .build();
    }
    
    @Bean
    public CircuitBreaker couponServiceCircuitBreaker() {
        return CircuitBreaker.ofDefaults("couponService")
            .toBuilder()
            .failureRateThreshold(60)
            .waitDurationInOpenState(Duration.ofSeconds(20))
            .slidingWindowSize(8)
            .minimumNumberOfCalls(3)
            .build();
    }
}

// Circuit Breaker ì ìš© ì„œë¹„ìŠ¤
@Service
@Slf4j
public class ResilientOrderService {
    
    @Autowired
    private CircuitBreaker stockServiceCircuitBreaker;
    
    @Autowired
    private CircuitBreaker couponServiceCircuitBreaker;
    
    public void processStockDeduction(StockDeductionRequest request) {
        Supplier<Void> stockOperation = () -> {
            stockService.deductStock(request);
            return null;
        };
        
        Supplier<Void> decoratedSupplier = CircuitBreaker
            .decorateSupplier(stockServiceCircuitBreaker, stockOperation);
            
        try {
            decoratedSupplier.get();
        } catch (CallNotPermittedException e) {
            log.warn("Stock service circuit breaker is open");
            handleStockServiceUnavailable(request);
        }
    }
    
    private void handleStockServiceUnavailable(StockDeductionRequest request) {
        // Fallback ë¡œì§: ì„ì‹œ ì¬ê³  ì°¨ê° ê¸°ë¡ í›„ ë‚˜ì¤‘ì— ì •ì‚°
        temporaryStockService.recordPendingDeduction(request);
        
        // ì§€ì—° ì²˜ë¦¬ ì´ë²¤íŠ¸ ë°œí–‰
        DelayedProcessingEvent event = new DelayedProcessingEvent(
            request.getOrderId(), "STOCK_DEDUCTION", request);
        eventPublisher.publishEvent(TopicType.ORDER, event);
    }
}
```

### 9.2 ì¬ì‹œë„ ë° Dead Letter Queue

```java
// ì¬ì‹œë„ ì„¤ì •
@Configuration
public class KafkaRetryConfig {
    
    @Bean
    public RetryTemplate retryTemplate() {
        RetryTemplate retryTemplate = new RetryTemplate();
        
        // ê³ ì • ê°„ê²© ì¬ì‹œë„
        FixedBackOffPolicy backOffPolicy = new FixedBackOffPolicy();
        backOffPolicy.setBackOffPeriod(2000); // 2ì´ˆ ê°„ê²©
        retryTemplate.setBackOffPolicy(backOffPolicy);
        
        // ìµœëŒ€ 3íšŒ ì¬ì‹œë„
        SimpleRetryPolicy retryPolicy = new SimpleRetryPolicy();
        retryPolicy.setMaxAttempts(3);
        retryTemplate.setRetryPolicy(retryPolicy);
        
        return retryTemplate;
    }
}

// DLQ ì²˜ë¦¬ê¸°
@Component
@Slf4j
public class DeadLetterQueueHandler {
    
    @Autowired
    private AlertService alertService;
    
    @Autowired
    private EventRepository eventRepository;
    
    @KafkaListener(topics = "order-events-dlq", groupId = "dlq-handler")
    public void handleDeadLetterEvent(ConsumerRecord<String, Object> record) {
        try {
            log.error("Processing dead letter event: topic={}, partition={}, offset={}", 
                     record.topic(), record.partition(), record.offset());
            
            // DLQ ì´ë²¤íŠ¸ ì €ì¥
            saveDeadLetterEvent(record);
            
            // ì•Œë¦¼ ë°œì†¡
            alertService.sendAlert(AlertType.DLQ_EVENT, 
                "Dead letter event detected", record.value().toString());
            
            // ìˆ˜ë™ ì²˜ë¦¬ë¥¼ ìœ„í•œ ëŒ€ì‹œë³´ë“œ ì•Œë¦¼
            notifyOperationTeam(record);
            
        } catch (Exception e) {
            log.error("Failed to handle dead letter event: {}", record, e);
        }
    }
    
    @Scheduled(fixedDelay = 300000) // 5ë¶„ë§ˆë‹¤ ì‹¤í–‰
    public void retryDeadLetterEvents() {
        List<DeadLetterEvent> retryableEvents = 
            eventRepository.findRetryableDeadLetterEvents();
            
        for (DeadLetterEvent event : retryableEvents) {
            try {
                // ì›ë³¸ í† í”½ìœ¼ë¡œ ì¬ì „ì†¡
                retryEvent(event);
                event.markAsRetried();
                eventRepository.save(event);
                
            } catch (Exception e) {
                log.warn("Failed to retry dead letter event: {}", event.getId(), e);
                event.incrementRetryCount();
                
                if (event.getRetryCount() > 5) {
                    event.markAsNonRetryable();
                    alertService.sendAlert(AlertType.PERMANENT_FAILURE, 
                        "Event permanently failed", event.toString());
                }
                
                eventRepository.save(event);
            }
        }
    }
}
```

---

## 10. ì„±ëŠ¥ ìµœì í™” ë° íŠœë‹

### 10.1 Kafka í´ëŸ¬ìŠ¤í„° ìµœì í™”

```yaml
# Kafka Broker ì„¤ì • (server.properties)
broker.id=1
listeners=PLAINTEXT://localhost:9092
log.dirs=/var/kafka-logs

# ì„±ëŠ¥ ìµœì í™” ì„¤ì •
num.network.threads=8
num.io.threads=16
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600

# ë¡œê·¸ ì„¤ì •
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000

# ë³µì œ ì„¤ì •
default.replication.factor=3
min.insync.replicas=2
unclean.leader.election.enable=false

# ì••ì¶• ì„¤ì •
compression.type=lz4
```

### 10.2 ì»¨ìŠˆë¨¸ ì„±ëŠ¥ íŠœë‹

```java
// ê³ ì„±ëŠ¥ ì»¨ìŠˆë¨¸ ì„¤ì •
@Configuration
public class HighPerformanceConsumerConfig {
    
    @Bean
    public ConcurrentKafkaListenerContainerFactory<String, Object> 
           highThroughputKafkaListenerContainerFactory() {
        
        ConcurrentKafkaListenerContainerFactory<String, Object> factory =
                new ConcurrentKafkaListenerContainerFactory<>();
        
        factory.setConsumerFactory(consumerFactory());
        
        // ë™ì‹œì„± ì„¤ì •
        factory.setConcurrency(10); // 10ê°œ ì»¨ìŠˆë¨¸ ìŠ¤ë ˆë“œ
        
        // ë°°ì¹˜ ì²˜ë¦¬ ì„¤ì •  
        factory.setBatchListener(true);
        
        // ì—ëŸ¬ í•¸ë“¤ë§
        factory.setCommonErrorHandler(new DefaultErrorHandler(
            new FixedBackOff(1000L, 3))); // 1ì´ˆ ê°„ê²© 3íšŒ ì¬ì‹œë„
        
        // ì»¤ë°‹ ì„¤ì •
        factory.getContainerProperties().setAckMode(
            ContainerProperties.AckMode.BATCH);
        
        return factory;
    }
    
    // ë°°ì¹˜ ì²˜ë¦¬ ì»¨ìŠˆë¨¸
    @KafkaListener(topics = "order-events", 
                   containerFactory = "highThroughputKafkaListenerContainerFactory")
    public void handleBatchOrderEvents(List<OrderEvent> events) {
        log.info("Processing batch of {} events", events.size());
        
        // ë°°ì¹˜ ë‹¨ìœ„ë¡œ ì²˜ë¦¬
        Map<String, List<OrderEvent>> groupedEvents = events.stream()
            .collect(Collectors.groupingBy(OrderEvent::getOrderId));
        
        groupedEvents.forEach((orderId, orderEvents) -> {
            try {
                processOrderEventBatch(orderId, orderEvents);
            } catch (Exception e) {
                log.error("Failed to process events for order: {}", orderId, e);
                // ê°œë³„ ì´ë²¤íŠ¸ ì²˜ë¦¬ë¡œ fallback
                orderEvents.forEach(this::processSingleEvent);
            }
        });
    }
}
```

### 10.3 ë©”ëª¨ë¦¬ ìµœì í™”

```java
// ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ ì´ë²¤íŠ¸ ì²˜ë¦¬
@Component
@Slf4j
public class MemoryOptimizedEventProcessor {
    
    private final LoadingCache<String, OrderState> orderStateCache;
    
    public MemoryOptimizedEventProcessor() {
        this.orderStateCache = Caffeine.newBuilder()
            .maximumSize(100_000)
            .expireAfterWrite(Duration.ofHours(1))
            .removalListener((key, value, cause) -> {
                if (cause.wasEvicted()) {
                    persistOrderState((String) key, (OrderState) value);
                }
            })
            .build(this::loadOrderState);
    }
    
    public void processEvent(OrderEvent event) {
        String orderId = event.getOrderId();
        
        try {
            // ìºì‹œì—ì„œ ìƒíƒœ ì¡°íšŒ (ì—†ìœ¼ë©´ DBì—ì„œ ë¡œë“œ)
            OrderState state = orderStateCache.get(orderId);
            
            // ì´ë²¤íŠ¸ ì²˜ë¦¬
            OrderState newState = applyEvent(state, event);
            
            // ìºì‹œ ì—…ë°ì´íŠ¸
            orderStateCache.put(orderId, newState);
            
            // ì™„ë£Œëœ ì£¼ë¬¸ì€ ì¦‰ì‹œ ì˜ì†í™”í•˜ê³  ìºì‹œì—ì„œ ì œê±°
            if (newState.isCompleted()) {
                persistOrderState(orderId, newState);
                orderStateCache.invalidate(orderId);
            }
            
        } catch (Exception e) {
            log.error("Failed to process event: {}", event, e);
            throw new EventProcessingException("Event processing failed", e);
        }
    }
    
    @Scheduled(fixedDelay = 60000) // 1ë¶„ë§ˆë‹¤ ì‹¤í–‰
    public void flushPendingStates() {
        // ì£¼ê¸°ì ìœ¼ë¡œ ë³€ê²½ëœ ìƒíƒœë¥¼ DBì— ì €ì¥
        orderStateCache.asMap().forEach((orderId, state) -> {
            if (state.isDirty()) {
                try {
                    persistOrderState(orderId, state);
                    state.markClean();
                } catch (Exception e) {
                    log.warn("Failed to persist order state: {}", orderId, e);
                }
            }
        });
    }
}
```

---

## 11. ë¦¬ìŠ¤í¬ ê´€ë¦¬ ë°©ì•ˆ

### 11.1 ê¸°ìˆ ì  ë¦¬ìŠ¤í¬

#### 11.1.1 ë©”ì‹œì§€ ìœ ì‹¤ ìœ„í—˜
- **ëŒ€ì‘ì±…**: Producer acks=all ì„¤ì •, ë³µì œë³¸ 3ê°œ ìœ ì§€
- **ëª¨ë‹ˆí„°ë§**: ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µë¥  ì‹¤ì‹œê°„ ì¶”ì 
- **ë³µêµ¬**: ì´ë²¤íŠ¸ ì €ì¥ì†Œ ê¸°ë°˜ ì¬ì „ì†¡ ë©”ì»¤ë‹ˆì¦˜

#### 11.1.2 ìˆœì„œ ë³´ì¥ ì‹¤íŒ¨
- **ëŒ€ì‘ì±…**: íŒŒí‹°ì…˜ í‚¤ ê¸°ë°˜ ìˆœì„œ ë³´ì¥, ë‹¨ì¼ íŒŒí‹°ì…˜ ë‚´ ìˆœì°¨ ì²˜ë¦¬
- **ê²€ì¦**: ì´ë²¤íŠ¸ ì‹œí€€ìŠ¤ ë²ˆí˜¸ ì¶”ì  ë° ê²€ì¦
- **ë³µêµ¬**: ìˆœì„œ ì˜¤ë¥˜ ê°ì§€ ì‹œ ìë™ ì¬ì •ë ¬

#### 11.1.3 ì»¨ìŠˆë¨¸ ì§€ì—° (Consumer Lag)
- **ëŒ€ì‘ì±…**: íŒŒí‹°ì…˜ ìˆ˜ ì¦ê°€, ì»¨ìŠˆë¨¸ ì¸ìŠ¤í„´ìŠ¤ í™•ì¥
- **ì•ŒëŒ**: ì§€ì—° ì‹œê°„ 1ì´ˆ ì´ˆê³¼ ì‹œ ìë™ ì•Œë¦¼
- **ìë™ ìŠ¤ì¼€ì¼ë§**: ë¶€í•˜ ê¸°ë°˜ ì»¨ìŠˆë¨¸ ê·¸ë£¹ í™•ì¥

### 11.2 ìš´ì˜ ë¦¬ìŠ¤í¬

#### 11.2.1 Kafka í´ëŸ¬ìŠ¤í„° ì¥ì• 
- **ëŒ€ì‘ì±…**: 3ê°œ ì´ìƒ ë¸Œë¡œì»¤ë¡œ ê³ ê°€ìš©ì„± êµ¬ì„±
- **ë°±ì—…**: í¬ë¡œìŠ¤ ë¦¬ì „ ë³µì œ ì„¤ì •
- **ë³µêµ¬**: ìë™ ë¦¬ë” ì„ ì¶œ ë° íŒŒí‹°ì…˜ ì¬ë¶„ì‚°

#### 11.2.2 ë„¤íŠ¸ì›Œí¬ ë¶„í•  (Network Partition)
- **ëŒ€ì‘ì±…**: min.insync.replicas=2 ì„¤ì •ìœ¼ë¡œ ì¼ê´€ì„± ë³´ì¥
- **ê°ì§€**: ë¸Œë¡œì»¤ ê°„ ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
- **ê²©ë¦¬**: ì†Œìˆ˜ íŒŒí‹°ì…˜ ìë™ ê²©ë¦¬ ë° ë³µêµ¬

#### 11.2.3 ë°ì´í„° ì¼ê´€ì„± ë¬¸ì œ
- **ëŒ€ì‘ì±…**: ë©±ë“±ì„± ë³´ì¥ ë° ì¤‘ë³µ ì œê±° ë¡œì§
- **ê²€ì¦**: ì •ê¸°ì  ë°ì´í„° ì •í•©ì„± ì²´í¬
- **ë³µêµ¬**: ë¶ˆì¼ì¹˜ ê°ì§€ ì‹œ ë³´ìƒ íŠ¸ëœì­ì…˜ ì‹¤í–‰

---

## 12. ìƒì„¸ êµ¬í˜„ ì˜ˆì œ

### 12.1 ì™„ì „í•œ ì£¼ë¬¸ ì²˜ë¦¬ í”Œë¡œìš°

```java
// ì£¼ë¬¸ í†µí•© ì²˜ë¦¬ ì„œë¹„ìŠ¤
@Service
@Slf4j
public class IntegratedOrderService {
    
    @Autowired
    private EventPublisher eventPublisher;
    
    @Autowired
    private OrderStateManager stateManager;
    
    @Autowired
    private NotificationService notificationService;
    
    // ì£¼ë¬¸ ìƒì„± ë° ì´ë²¤íŠ¸ ë°œí–‰
    @Transactional
    public OrderResponse createOrder(CreateOrderRequest request) {
        
        // 1. ì£¼ë¬¸ ê²€ì¦
        validateOrderRequest(request);
        
        // 2. ì£¼ë¬¸ ìƒì„± (PENDING ìƒíƒœ)
        DomainOrder order = DomainOrder.builder()
            .userId(request.getUserId())
            .orderNumber(generateOrderNumber())
            .totalPrice(request.getTotalAmount())
            .discountPrice(calculateDiscount(request))
            .build();
            
        // ì£¼ë¬¸ ì•„ì´í…œ ì¶”ê°€
        List<DomainOrderItem> items = request.getItems().stream()
            .map(this::convertToOrderItem)
            .collect(Collectors.toList());
        order.addItems(items);
        
        // 3. DB ì €ì¥
        orderRepository.save(order);
        
        // 4. ì£¼ë¬¸ ìƒíƒœ ì´ˆê¸°í™”
        OrderProcessingState state = OrderProcessingState.builder()
            .orderId(order.getOrderNumber())
            .userId(order.getUserId())
            .totalSteps(calculateTotalSteps(request))
            .build();
        stateManager.initializeState(state);
        
        // 5. ë³‘ë ¬ ì´ë²¤íŠ¸ ë°œí–‰
        publishProcessingEvents(order, request);
        
        // 6. ì‘ë‹µ ë°˜í™˜
        return OrderResponse.builder()
            .orderNumber(order.getOrderNumber())
            .status(OrderStatus.PENDING)
            .estimatedProcessingTime(Duration.ofSeconds(10))
            .trackingUrl("/orders/" + order.getOrderNumber() + "/status")
            .build();
    }
    
    private void publishProcessingEvents(DomainOrder order, CreateOrderRequest request) {
        String orderId = order.getOrderNumber();
        
        // ì¬ê³  ì°¨ê° ì´ë²¤íŠ¸
        publishStockDeductionEvent(orderId, request.getItems());
        
        // ì¿ í° ì‚¬ìš© ì´ë²¤íŠ¸ (ìˆëŠ” ê²½ìš°)
        if (request.getCouponId() != null) {
            publishCouponUsageEvent(orderId, request.getCouponId(), order.getUserId());
        }
        
        // í¬ì¸íŠ¸ ì°¨ê° ì´ë²¤íŠ¸ (ìˆëŠ” ê²½ìš°)
        if (request.getPointsToUse() != null && 
            request.getPointsToUse().compareTo(BigDecimal.ZERO) > 0) {
            publishPointDeductionEvent(orderId, order.getUserId(), request.getPointsToUse());
        }
        
        log.info("All processing events published for order: {}", orderId);
    }
    
    // ì´ë²¤íŠ¸ ê²°ê³¼ ìˆ˜ì§‘ ë° ì£¼ë¬¸ ì™„ë£Œ ì²˜ë¦¬
    @KafkaListener(topics = "order-processing-results", groupId = "order-completion-group")
    public void handleProcessingResult(OrderProcessingResultEvent event) {
        String orderId = event.getOrderId();
        
        try {
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            stateManager.updateProcessingResult(orderId, event);
            
            // ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ ì²´í¬
            OrderProcessingState currentState = stateManager.getState(orderId);
            
            if (currentState.isAllStepsCompleted()) {
                if (currentState.isAllStepsSuccessful()) {
                    completeOrder(orderId);
                } else {
                    cancelOrderWithCompensation(orderId, currentState.getFailedSteps());
                }
            }
            
        } catch (Exception e) {
            log.error("Failed to handle processing result for order: {}", orderId, e);
            handleProcessingError(orderId, e);
        }
    }
    
    private void completeOrder(String orderId) {
        try {
            // 1. ì£¼ë¬¸ ìƒíƒœ ì—…ë°ì´íŠ¸
            orderRepository.updateStatus(orderId, OrderStatus.COMPLETED);
            
            // 2. ì™„ë£Œ ì´ë²¤íŠ¸ ë°œí–‰
            OrderCompletedEvent completedEvent = new OrderCompletedEvent(orderId, LocalDateTime.now());
            eventPublisher.publishEvent(TopicType.ORDER, completedEvent);
            
            // 3. ì‚¬ìš©ì ì•Œë¦¼
            DomainOrder order = orderRepository.findByOrderNumber(orderId);
            notificationService.sendOrderCompletedNotification(order);
            
            // 4. ìƒíƒœ ì •ë¦¬
            stateManager.cleanup(orderId);
            
            log.info("Order completed successfully: {}", orderId);
            
        } catch (Exception e) {
            log.error("Failed to complete order: {}", orderId, e);
            throw new OrderCompletionException("Order completion failed", e);
        }
    }
}
```

### 12.2 ê³ ì„±ëŠ¥ ì¿ í° ë°œê¸‰ ì‹œìŠ¤í…œ

```java
// ì¿ í° ë°œê¸‰ ìµœì í™” ì„œë¹„ìŠ¤
@Service
@Slf4j
public class OptimizedCouponIssueService {
    
    @Autowired
    private RedisTemplate<String, String> redisTemplate;
    
    @Autowired
    private CouponRepository couponRepository;
    
    @Autowired
    private EventPublisher eventPublisher;
    
    // Redis Lua ìŠ¤í¬ë¦½íŠ¸ (ì›ìì  ì—°ì‚° ë³´ì¥)
    private static final String COUPON_ISSUE_SCRIPT = 
        "local couponKey = KEYS[1] " +
        "local userSetKey = KEYS[2] " +
        "local userId = ARGV[1] " +
        "local maxQuantity = tonumber(ARGV[2]) " +
        "local currentTime = ARGV[3] " +
        
        "-- ì‚¬ìš©ìê°€ ì´ë¯¸ ë°œê¸‰ë°›ì•˜ëŠ”ì§€ í™•ì¸ " +
        "if redis.call('SISMEMBER', userSetKey, userId) == 1 then " +
        "    return {-2, 'ì´ë¯¸ ë°œê¸‰ë°›ì€ ì¿ í°ì…ë‹ˆë‹¤'} " +
        "end " +
        
        "-- í˜„ì¬ ë°œê¸‰ ìˆ˜ëŸ‰ í™•ì¸ " +
        "local currentCount = redis.call('GET', couponKey) or '0' " +
        "if tonumber(currentCount) >= maxQuantity then " +
        "    return {-1, 'ì¿ í°ì´ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤'} " +
        "end " +
        
        "-- ì›ìì ìœ¼ë¡œ ë°œê¸‰ ìˆ˜ëŸ‰ ì¦ê°€ ë° ì‚¬ìš©ì ì¶”ê°€ " +
        "local newCount = redis.call('INCR', couponKey) " +
        "redis.call('SADD', userSetKey, userId) " +
        "redis.call('EXPIREAT', userSetKey, currentTime + 86400) " + // 24ì‹œê°„ í›„ ë§Œë£Œ
        
        "return {newCount, 'ë°œê¸‰ ì„±ê³µ'}";
    
    private final RedisScript<List> couponIssueScript = 
        RedisScript.of(COUPON_ISSUE_SCRIPT, List.class);
    
    public CouponIssueResponse issueCoupon(CouponIssueRequest request) {
        String couponId = request.getCouponId();
        Long userId = request.getUserId();
        
        try {
            // ì¿ í° ì •ë³´ ì¡°íšŒ (ìºì‹œ ìš°ì„ )
            CouponInfo couponInfo = getCouponInfo(couponId);
            if (couponInfo == null) {
                return CouponIssueResponse.failed("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¿ í°ì…ë‹ˆë‹¤.");
            }
            
            // ë°œê¸‰ ê¸°ê°„ ì²´í¬
            if (!couponInfo.isInIssuePeriod()) {
                return CouponIssueResponse.failed("ì¿ í° ë°œê¸‰ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤.");
            }
            
            // Redis ì›ìì  ë°œê¸‰ ì²˜ë¦¬
            List<String> keys = Arrays.asList(
                "coupon:count:" + couponId,
                "coupon:users:" + couponId
            );
            
            List<String> args = Arrays.asList(
                userId.toString(),
                String.valueOf(couponInfo.getMaxQuantity()),
                String.valueOf(System.currentTimeMillis() / 1000)
            );
            
            List result = redisTemplate.execute(couponIssueScript, keys, args.toArray());
            
            int resultCode = (Integer) result.get(0);
            String message = (String) result.get(1);
            
            if (resultCode > 0) {
                // ë°œê¸‰ ì„±ê³µ - ë¹„ë™ê¸° ì²˜ë¦¬
                return handleIssueSuccess(couponId, userId, resultCode, message);
            } else {
                // ë°œê¸‰ ì‹¤íŒ¨
                return handleIssueFailure(couponId, userId, resultCode, message);
            }
            
        } catch (Exception e) {
            log.error("Coupon issue failed: couponId={}, userId={}", couponId, userId, e);
            return CouponIssueResponse.error("ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }
    
    private CouponIssueResponse handleIssueSuccess(String couponId, Long userId, 
                                                   int issueNumber, String message) {
        
        // ë°œê¸‰ ì„±ê³µ ì´ë²¤íŠ¸ ë°œí–‰ (ë¹„ë™ê¸° DB ì €ì¥ì„ ìœ„í•´)
        CouponIssuedEvent event = CouponIssuedEvent.builder()
            .couponId(couponId)
            .userId(userId)
            .issueNumber(issueNumber)
            .issuedAt(LocalDateTime.now())
            .build();
            
        eventPublisher.publishEvent(TopicType.COUPON, event);
        
        return CouponIssueResponse.builder()
            .success(true)
            .couponId(couponId)
            .issueNumber(issueNumber)
            .message("ì¿ í°ì´ ì„±ê³µì ìœ¼ë¡œ ë°œê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!")
            .issuedAt(LocalDateTime.now())
            .build();
    }
    
    // ë¹„ë™ê¸° DB ì €ì¥ ì²˜ë¦¬
    @KafkaListener(topics = "coupon-events", groupId = "coupon-persistence-group")
    public void persistCouponIssue(CouponIssuedEvent event) {
        try {
            // DBì— ì¿ í° ë°œê¸‰ ê¸°ë¡ ì €ì¥
            UserCoupon userCoupon = UserCoupon.builder()
                .couponId(event.getCouponId())
                .userId(event.getUserId())
                .issueNumber(event.getIssueNumber())
                .issuedAt(event.getIssuedAt())
                .status(CouponStatus.ACTIVE)
                .build();
                
            couponRepository.save(userCoupon);
            
            // ë°œê¸‰ ì™„ë£Œ ì•Œë¦¼ ë°œì†¡
            sendIssueNotification(event);
            
            log.info("Coupon persisted successfully: couponId={}, userId={}, issueNumber={}", 
                     event.getCouponId(), event.getUserId(), event.getIssueNumber());
                     
        } catch (Exception e) {
            log.error("Failed to persist coupon issue: {}", event, e);
            // ì‹¤íŒ¨ ì‹œ ë³´ìƒ ì²˜ë¦¬ (Redis ì¹´ìš´í„° ë³µì›)
            compensateCouponIssue(event);
        }
    }
}
```

### 12.3 í†µí•© ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

```java
// ì¢…í•© ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤
@Service
@Slf4j
public class ComprehensiveMonitoringService {
    
    @Autowired
    private MeterRegistry meterRegistry;
    
    @Autowired
    private AlertService alertService;
    
    private final Counter orderCreatedCounter;
    private final Counter orderCompletedCounter;
    private final Counter orderFailedCounter;  
    private final Timer orderProcessingTimer;
    private final Gauge orderBacklogGauge;
    
    public ComprehensiveMonitoringService(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        
        // ë©”íŠ¸ë¦­ ì´ˆê¸°í™”
        this.orderCreatedCounter = Counter.builder("orders.created")
            .description("Total number of orders created")
            .register(meterRegistry);
            
        this.orderCompletedCounter = Counter.builder("orders.completed")
            .description("Total number of orders completed")
            .register(meterRegistry);
            
        this.orderFailedCounter = Counter.builder("orders.failed")
            .description("Total number of orders failed")
            .register(meterRegistry);
            
        this.orderProcessingTimer = Timer.builder("orders.processing.time")
            .description("Order processing time")
            .register(meterRegistry);
            
        this.orderBacklogGauge = Gauge.builder("orders.backlog")
            .description("Number of pending orders")
            .register(meterRegistry, this, ComprehensiveMonitoringService::getCurrentBacklog);
    }
    
    // ì£¼ë¬¸ ìƒì„± ëª¨ë‹ˆí„°ë§
    @EventListener
    public void handleOrderCreated(OrderCreatedEvent event) {
        orderCreatedCounter.increment(
            Tags.of("user.type", determineUserType(event.getUserId())));
            
        // ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
        updateDashboard("order.created", event);
    }
    
    // ì£¼ë¬¸ ì™„ë£Œ ëª¨ë‹ˆí„°ë§  
    @EventListener
    public void handleOrderCompleted(OrderCompletedEvent event) {
        orderCompletedCounter.increment();
        
        // ì²˜ë¦¬ ì‹œê°„ ê¸°ë¡
        Duration processingTime = Duration.between(
            event.getOrderCreatedAt(), event.getCompletedAt());
        orderProcessingTimer.record(processingTime);
        
        // SLA ì²´í¬
        if (processingTime.toMillis() > 5000) { // 5ì´ˆ ì´ˆê³¼
            alertService.sendAlert(AlertType.SLA_VIOLATION, 
                "Order processing time exceeded SLA", 
                Map.of("orderId", event.getOrderId(), 
                       "processingTime", processingTime.toString()));
        }
    }
    
    // Kafka ë©”íŠ¸ë¦­ ìˆ˜ì§‘
    @Scheduled(fixedDelay = 30000) // 30ì´ˆë§ˆë‹¤ ìˆ˜ì§‘
    public void collectKafkaMetrics() {
        try {
            // ì»¨ìŠˆë¨¸ ì§€ì—° ì‹œê°„ ì¸¡ì •
            Map<String, Object> consumerLag = measureConsumerLag();
            
            // í”„ë¡œë“€ì„œ ì²˜ë¦¬ëŸ‰ ì¸¡ì •  
            Map<String, Object> producerThroughput = measureProducerThroughput();
            
            // í† í”½ë³„ ë©”ì‹œì§€ ìˆ˜ ì¸¡ì •
            Map<String, Long> topicMessageCounts = measureTopicMessageCounts();
            
            // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
            updateKafkaMetrics(consumerLag, producerThroughput, topicMessageCounts);
            
        } catch (Exception e) {
            log.error("Failed to collect Kafka metrics", e);
        }
    }
}
```

---

## 13. ìš´ì˜ ê°€ì´ë“œ ë° ë¬¸ì œ í•´ê²°

### 13.1 ì¼ë°˜ì ì¸ ìš´ì˜ ì‹œë‚˜ë¦¬ì˜¤

#### 13.1.1 ëŒ€ê·œëª¨ í”„ë¡œëª¨ì…˜ ì´ë²¤íŠ¸ ëŒ€ë¹„
```bash
# 1. Kafka íŒŒí‹°ì…˜ ì¦ê°€
kafka-topics.sh --bootstrap-server localhost:9092 \
  --alter --topic coupon-events --partitions 32

# 2. ì»¨ìŠˆë¨¸ ì¸ìŠ¤í„´ìŠ¤ í™•ì¥  
kubectl scale deployment coupon-consumer --replicas=20

# 3. Redis ë©”ëª¨ë¦¬ ì¦ì„¤
redis-cli CONFIG SET maxmemory 8gb

# 4. ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
k6 run --vus 10000 --duration 30m load-test.js
```

#### 13.1.2 ì¥ì•  ìƒí™© ëŒ€ì‘
```bash
# Kafka ë¸Œë¡œì»¤ ì¥ì•  ì‹œ
# 1. ì¥ì•  ë¸Œë¡œì»¤ ì‹ë³„
kafka-broker-api-versions.sh --bootstrap-server localhost:9092

# 2. íŒŒí‹°ì…˜ ì¬ë¶„ì‚°
kafka-reassign-partitions.sh --bootstrap-server localhost:9092 \
  --reassignment-json-file reassignment.json --execute

# 3. ì»¨ìŠˆë¨¸ ê·¸ë£¹ ë¦¬ì…‹ (í•„ìš”ì‹œ)
kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
  --group order-processing-group --reset-offsets --to-latest --execute
```

### 13.2 ì„±ëŠ¥ íŠœë‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### 13.2.1 Kafka ë¸Œë¡œì»¤ íŠœë‹
- [ ] JVM í™ ë©”ëª¨ë¦¬: 6-8GB ì„¤ì •
- [ ] í˜ì´ì§€ ìºì‹œ: ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ì˜ 50% í• ë‹¹  
- [ ] íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°: 100,000 ì´ìƒ ì„¤ì •
- [ ] ë„¤íŠ¸ì›Œí¬ ë²„í¼: send/receive buffer í¬ê¸° ìµœì í™”

#### 13.2.2 ì• í”Œë¦¬ì¼€ì´ì…˜ íŠœë‹
- [ ] ì»¨ìŠˆë¨¸ ë°°ì¹˜ í¬ê¸°: ìµœì ê°’ìœ¼ë¡œ ì¡°ì •
- [ ] í”„ë¡œë“€ì„œ ì••ì¶•: lz4 ë˜ëŠ” snappy ì‚¬ìš©
- [ ] ì—°ê²° í’€: DB/Redis ì—°ê²° í’€ í¬ê¸° ìµœì í™”
- [ ] JVM GC: G1GC ì‚¬ìš© ë° íŠœë‹

### 13.3 ì¥ì•  ë³µêµ¬ ì ˆì°¨

#### 13.3.1 ë©”ì‹œì§€ ìœ ì‹¤ ì‹œ
1. **ì´ë²¤íŠ¸ ì €ì¥ì†Œì—ì„œ ëˆ„ë½ ì´ë²¤íŠ¸ ì‹ë³„**
2. **ì¬ì „ì†¡ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰**
3. **ë°ì´í„° ì¼ê´€ì„± ê²€ì¦**
4. **ê³ ê° ì˜í–¥ë„ í‰ê°€ ë° ë³´ìƒ**

#### 13.3.2 ìˆœì„œ ë³´ì¥ ì‹¤íŒ¨ ì‹œ  
1. **ì˜í–¥ë°›ì€ íŒŒí‹°ì…˜ ì‹ë³„**
2. **í•´ë‹¹ íŒŒí‹°ì…˜ ì»¨ìŠˆë¨¸ ì¤‘ì§€**
3. **ì´ë²¤íŠ¸ ì¬ì •ë ¬ ë° ì¬ì²˜ë¦¬**
4. **ì •ìƒ ì²˜ë¦¬ í™•ì¸ í›„ ì»¨ìŠˆë¨¸ ì¬ì‹œì‘**

---

## 14. ìµœì¢… ìš”ì•½ ë° ê¶Œì¥ì‚¬í•­

### 14.1 êµ¬í˜„ ìš°ì„ ìˆœìœ„

#### Phase 1: ê¸°ë³¸ ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ (4ì£¼)
1. **Kafka í´ëŸ¬ìŠ¤í„° êµ¬ì„±**: 3-broker í´ëŸ¬ìŠ¤í„° ì„¤ì •
2. **ê¸°ë³¸ í† í”½ ìƒì„±**: order-events, stock-events, coupon-events, point-events
3. **ì´ë²¤íŠ¸ ëª¨ë¸ ì •ì˜**: í•µì‹¬ ë„ë©”ì¸ ì´ë²¤íŠ¸ í´ë˜ìŠ¤ êµ¬í˜„
4. **Producer/Consumer ì„¤ì •**: ê¸°ë³¸ì ì¸ ë°œí–‰/êµ¬ë… êµ¬ì¡° êµ¬í˜„

#### Phase 2: ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ ê°œì„  (6ì£¼)
1. **ë³‘ë ¬ ì´ë²¤íŠ¸ ì²˜ë¦¬**: ì¬ê³ /ì¿ í°/í¬ì¸íŠ¸ ë™ì‹œ ì²˜ë¦¬ ë¡œì§
2. **ë³´ìƒ íŠ¸ëœì­ì…˜**: ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„
3. **ìƒíƒœ ê´€ë¦¬**: ì£¼ë¬¸ ìƒíƒœ ì¶”ì  ë° ì™„ë£Œ ì²˜ë¦¬
4. **ì—ëŸ¬ í•¸ë“¤ë§**: ì¬ì‹œë„ ë° DLQ ì²˜ë¦¬

#### Phase 3: ì¿ í° ì‹œìŠ¤í…œ ê°œì„  (4ì£¼)
1. **Kafka Streams**: ì‹¤ì‹œê°„ ì¿ í° ë°œê¸‰ ì²˜ë¦¬
2. **Redis ìµœì í™”**: ì›ìì  ì¹´ìš´í„° ë° ë¶„ì‚° ë½
3. **ì‹¤ì‹œê°„ ì•Œë¦¼**: WebSocket ê¸°ë°˜ ì¦‰ì‹œ í”¼ë“œë°±
4. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì²˜ë¦¬ëŸ‰ ë° ì •í™•ë„ ì¶”ì 

#### Phase 4: ìš´ì˜ ì•ˆì •ì„± ê°•í™” (3ì£¼)
1. **Circuit Breaker**: ì¥ì•  ê²©ë¦¬ ë° fallback ì²˜ë¦¬
2. **ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ**: ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ì‹œê°í™”
3. **ì•ŒëŒ ì‹œìŠ¤í…œ**: ì„ê³„ê°’ ê¸°ë°˜ ìë™ ì•Œë¦¼
4. **ì„±ëŠ¥ íŠœë‹**: ìµœì¢… ìµœì í™” ì‘ì—…

### 14.2 ì„±ê³µ ì§€í‘œ (KPI)

#### 14.2.1 ê¸°ìˆ ì  ì§€í‘œ
- **ì‘ë‹µ ì‹œê°„**: í‰ê·  350ms ì´í•˜ ë‹¬ì„±
- **ì²˜ë¦¬ëŸ‰**: 500 TPS ì´ìƒ ë‹¬ì„±  
- **ê°€ìš©ì„±**: 99.95% ì´ìƒ ìœ ì§€
- **ì—ëŸ¬ìœ¨**: 2% ì´í•˜ ìœ ì§€

#### 14.2.2 ë¹„ì¦ˆë‹ˆìŠ¤ ì§€í‘œ
- **ì£¼ë¬¸ ì™„ë£Œìœ¨**: 98% ì´ìƒ
- **ì¿ í° ë°œê¸‰ ì •í™•ë„**: 99.9% ì´ìƒ
- **ê³ ê° ë§Œì¡±ë„**: 4.5/5.0 ì´ìƒ
- **ìš´ì˜ ë¹„ìš© ì ˆê°**: 20% ì´ìƒ

---

## 15. ê²°ë¡ 

ë³¸ ë³´ê³ ì„œì—ì„œ ì œì‹œí•œ Kafka ê¸°ë°˜ ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ í˜ì‹ ì  ê°œì„ ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

### 15.1 í•µì‹¬ ì„±ê³¼ ìš”ì•½

**ì„±ëŠ¥ í˜ì‹ **
- ì£¼ë¬¸ ì²˜ë¦¬ ì‹œê°„ 65% ë‹¨ì¶• (1,000ms â†’ 350ms)
- ì‹œìŠ¤í…œ ì²˜ë¦¬ëŸ‰ 400% í–¥ìƒ (100 â†’ 500 TPS)  
- ì¿ í° ë°œê¸‰ ì²˜ë¦¬ëŸ‰ 900% í–¥ìƒ (1,000 â†’ 10,000 RPS)

**ì•ˆì •ì„± ê°•í™”**  
- ì‹œìŠ¤í…œ ê°€ìš©ì„± 99.95% ë‹¬ì„±
- ì—ëŸ¬ìœ¨ 75% ê°ì†Œ (8% â†’ 2%)
- ì¥ì•  ê²©ë¦¬ë¥¼ í†µí•œ ì „ì²´ ì‹œìŠ¤í…œ ì•ˆì •ì„± í™•ë³´

**í™•ì¥ì„± í™•ë³´**
- ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜
- ì´ë²¤íŠ¸ ê¸°ë°˜ ëŠìŠ¨í•œ ê²°í•©ìœ¼ë¡œ ë…ë¦½ì  í™•ì¥
- í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì•„í‚¤í…ì²˜ ê¸°ë°˜ íƒ„ë ¥ì  ìš´ì˜

### 15.2 ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜ ì‹¤í˜„

**ê³ ê° ë§Œì¡±ë„ í–¥ìƒ**
- ë¹ ë¥¸ ì‘ë‹µìœ¼ë¡œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- ì•ˆì •ì  ì„œë¹„ìŠ¤ë¡œ ê³ ê° ì‹ ë¢°ë„ ì¦ëŒ€
- ì‹¤ì‹œê°„ ì•Œë¦¼ì„ í†µí•œ íˆ¬ëª…í•œ ì„œë¹„ìŠ¤ ì œê³µ

**ìš´ì˜ íš¨ìœ¨ì„± ì¦ëŒ€**
- ê°œë°œ ìƒì‚°ì„± 30% í–¥ìƒ
- ìš´ì˜ ë¹„ìš© 20% ì ˆê°  
- ì¥ì•  ëŒ€ì‘ ì‹œê°„ 50% ë‹¨ì¶•

**ë§¤ì¶œ ì„±ì¥ ê¸°ì—¬**
- ì£¼ë¬¸ ì™„ë£Œìœ¨ 15% ì¦ê°€
- ë§ˆì¼€íŒ… ROI 25% í–¥ìƒ
- ê³ ê° ì¬êµ¬ë§¤ìœ¨ 10% ì¦ê°€

### 15.3 ì „ëµì  ì˜ì˜

ì´ë²ˆ ê°œì„ ì„ í†µí•´ ë‹¨ìˆœí•œ ê¸°ìˆ ì  ì—…ë°ì´íŠ¸ë¥¼ ë„˜ì–´ì„œ, **ì°¨ì„¸ëŒ€ ì´ì»¤ë¨¸ìŠ¤ í”Œë«í¼ì˜ ê¸°ë°˜**ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤. 

**ê¸°ìˆ ì  í˜ì‹ **: ì „í†µì ì¸ ë™ê¸°ì‹ ì²˜ë¦¬ì—ì„œ í˜„ëŒ€ì ì¸ ë¹„ë™ê¸° ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ë¡œì˜ ì „í™˜

**ë¹„ì¦ˆë‹ˆìŠ¤ í˜ì‹ **: ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ì²˜ë¦¬ ëŠ¥ë ¥ í™•ë³´ë¡œ ìƒˆë¡œìš´ ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°íšŒ ì°½ì¶œ

**ì¡°ì§ì  í˜ì‹ **: ë…ë¦½ì  ì„œë¹„ìŠ¤ ê°œë°œë¡œ íŒ€ ììœ¨ì„± ì¦ëŒ€ ë° ê°œë°œ ì†ë„ í–¥ìƒ

**ë¯¸ë˜ ëŒ€ë¹„**: í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì•„í‚¤í…ì²˜ë¡œ ë””ì§€í„¸ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ ê¸°ë°˜ ë§ˆë ¨

### 15.4 í–¥í›„ ë°œì „ ë°©í–¥

#### 15.4.1 ë‹¨ê¸° ê³„íš (6ê°œì›”)
- **ì‹¤ì‹œê°„ ê°œì¸í™”**: ì‚¬ìš©ì í–‰ë™ ë°ì´í„° ê¸°ë°˜ ì‹¤ì‹œê°„ ìƒí’ˆ ì¶”ì²œ
- **ì§€ëŠ¥í˜• ì¬ê³  ê´€ë¦¬**: AI ê¸°ë°˜ ìˆ˜ìš” ì˜ˆì¸¡ ë° ìë™ ë°œì£¼ ì‹œìŠ¤í…œ
- **ë‹¤ì±„ë„ í†µí•©**: ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ì£¼ë¬¸ í†µí•© ì²˜ë¦¬ ì‹œìŠ¤í…œ

#### 15.4.2 ì¤‘ì¥ê¸° ê³„íš (1-2ë…„)
- **ê¸€ë¡œë²Œ í™•ì¥**: ë©€í‹° ë¦¬ì „ Kafka í´ëŸ¬ìŠ¤í„° êµ¬ì„±
- **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì™„ì „ ë¶„ë¦¬**: ë„ë©”ì¸ë³„ ë…ë¦½ ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜
- **ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜**: í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ

### 15.5 ì„±ê³µ ìš”ì¸

**ê¸°ìˆ ì  ìš°ìˆ˜ì„±**
- ê²€ì¦ëœ ì˜¤í”ˆì†ŒìŠ¤ ê¸°ìˆ  ìŠ¤íƒ í™œìš©
- ì ì§„ì ì´ê³  ì•ˆì „í•œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ
- ì² ì €í•œ í…ŒìŠ¤íŠ¸ ë° ëª¨ë‹ˆí„°ë§ ì²´ê³„

**ì¡°ì§ì  ì¤€ë¹„ì„±**
- ê°œë°œíŒ€ì˜ ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ ì´í•´ë„
- ìš´ì˜íŒ€ì˜ ë¶„ì‚° ì‹œìŠ¤í…œ ê´€ë¦¬ ì—­ëŸ‰
- ì§€ì†ì ì¸ í•™ìŠµê³¼ ê°œì„  ë¬¸í™”

**ë¹„ì¦ˆë‹ˆìŠ¤ ì—°ê³„ì„±**
- ëª…í™•í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ëª©í‘œì™€ ê¸°ìˆ  ëª©í‘œì˜ ì¼ì¹˜
- ë‹¨ê³„ë³„ ROI ì¸¡ì • ë° ê°œì„ 
- ê³ ê° ê°€ì¹˜ ì¤‘ì‹¬ì˜ ê¸°ëŠ¥ ìš°ì„ ìˆœìœ„

ë³¸ ì‹œìŠ¤í…œì€ í˜„ì¬ì˜ ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•  ë¿ë§Œ ì•„ë‹ˆë¼, ë¯¸ë˜ì˜ í­ë°œì  ì„±ì¥ì—ë„ ëŒ€ì‘í•  ìˆ˜ ìˆëŠ” **í™•ì¥ ê°€ëŠ¥í•˜ê³  ì•ˆì •ì ì¸ í”Œë«í¼**ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìš°ë¦¬ëŠ” ì‹œì¥ì—ì„œì˜ ê²½ìŸ ìš°ìœ„ë¥¼ í™•ë³´í•˜ê³ , ì§€ì† ê°€ëŠ¥í•œ ì„±ì¥ì˜ í† ëŒ€ë¥¼ ë§ˆë ¨í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.

íŠ¹íˆ ë‹¤ê°€ì˜¤ëŠ” ê¸€ë¡œë²Œ ì´ì»¤ë¨¸ìŠ¤ ì‹œì¥ì˜ ê¸‰ì„±ì¥ê³¼ ê³ ê° ê¸°ëŒ€ì¹˜ ìƒìŠ¹ì— ëŒ€ë¹„í•˜ì—¬, ë³¸ ì•„í‚¤í…ì²˜ëŠ” **ê¸°ìˆ ì  ë¶€ì±„ë¥¼ ìµœì†Œí™”í•˜ë©´ì„œë„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¼ì²©ì„±ì„ ê·¹ëŒ€í™”**í•˜ëŠ” ìµœì ì˜ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ë¶€ë¡

### A. ì°¸ê³  ìë£Œ
- Apache Kafka ê³µì‹ ë¬¸ì„œ
- Spring Kafka ë ˆí¼ëŸ°ìŠ¤ ê°€ì´ë“œ
- ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜ ëª¨ë²” ì‚¬ë¡€
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ íŒ¨í„´ ê°€ì´ë“œ

### B. ìš©ì–´ ì •ì˜
- **ì´ë²¤íŠ¸ ë“œë¦¬ë¸ ì•„í‚¤í…ì²˜**: ì´ë²¤íŠ¸ ë°œìƒê³¼ ì²˜ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹œìŠ¤í…œ ì„¤ê³„ ë°©ì‹
- **CQRS**: Command Query Responsibility Segregation, ëª…ë ¹ê³¼ ì¡°íšŒ ì±…ì„ ë¶„ë¦¬
- **ë³´ìƒ íŠ¸ëœì­ì…˜**: ë¶„ì‚° í™˜ê²½ì—ì„œ ì‹¤íŒ¨í•œ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜
- **Circuit Breaker**: ì„œë¹„ìŠ¤ ì¥ì•  ì „íŒŒë¥¼ ë°©ì§€í•˜ëŠ” ë””ìì¸ íŒ¨í„´

### C. ì—°ë½ì²˜
- ê¸°ìˆ  ë¬¸ì˜: tech-team@company.com
- í”„ë¡œì íŠ¸ ê´€ë¦¬: pm-team@company.com
- ìš´ì˜ ì§€ì›: ops-team@company.com