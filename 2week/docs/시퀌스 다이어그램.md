# 시퀀스 다이어그램

## 잔액
###  잔액 조회
```mermaid
sequenceDiagram
    autonumber
    actor 클라이언트
    participant 서비스
    participant 사용자
    participant 잔고
    클라이언트 ->>+ 서비스: 잔액 조회 요청
    서비스 ->>+ 사용자: 사용자 조회
    
    opt 사용자 존재 ❌
        사용자 -->>- 클라이언트: 사용자 미존재 예외 처리
    end
    
    사용자 ->>+ 잔고: 잔고 조회
    잔고 -->>- 서비스: 잔고 값 가져오기
    서비스 -->- 클라이언트:  잔액 조회 완료 ✅
```
1. 서비스에 요청한다.
2. 2~3 사용자 조회 하고 사용자 없으면 오류 보낸다.
3. 4~6 잔고를 조회해서 클라이언트한테 잔액을 제공한다.

###  잔액 충전
```mermaid
sequenceDiagram
    autonumber
    actor 클라이언트
    participant 서비스
    participant 사용자
    participant 잔고
    participant 잔고이력
    클라이언트 ->>+ 서비스: 잔액 충전 요청
    서비스 ->>+ 사용자: 사용자 조회
    
    opt 사용자 존재 ❌
        사용자 -->>- 클라이언트: 사용자 미존재 오류
        
    end
    사용자 ->>+ 잔고: 잔고 조회 +
    opt 충전 요청 금액이 x원 미만 
        잔고 -->> 클라이언트: 충전 요청 금액이 x원 아상 하라고 요청 보냄
    end
    opt 충전 후 한도가 초과 될때
        잔고 -->> 클라이언트: 충전 요청 금액이 초과 되었다고 오류 보냄
    end
    잔고 ->> 잔고: 잔고 충전 처리
    
    잔고 ->>+ 잔고이력: 충력 이력 저장
    잔고이력 -->>- 잔고: 충력 이력 저장완료
    
    잔고 -->>- 서비스: 충전 완료
    서비스 -->>- 클라이언트: 잔액 충전 요청 완료 ✅

```
1. 서비스에 요청한다.
2. 2~3 사용자 조회 하고 사용자 없으면 오류 보낸다.
3. 4~7 잔고를 조회사 이상 없으면 충전 한다.
4. 8~9: 충전 아력을 저장한다.

## 상품
### 상품 조회
```mermaid
sequenceDiagram
    autonumber
    actor 클라이언트
    participant 서비스
    participant 상품
    participant 재고
    클라이언트 ->>+ 서비스: 상품 조회 요청
    서비스 ->>+ 상품: 상품 조회
    
    opt 상품 존재 ❌
        상품 -->> 클라이언트: 상품 미존재 예외 처리
    end

    상품 ->>+ 재고: 재고 조회
    재고 -->>- 상품: 재고 조회 완료
    상품 -->>- 서비스: 상품 조회 완료
    서비스 -->- 클라이언트:  상품 조회 요청 완료 ✅(상품과 재고 정보를 제공한다.)
```
1. 서비스에 요청한다.
2. 2~3 상품 조회 하고 사용자 없으면 오류 보낸다.
3. 4~5 재고 조회 한다.

## 쿠폰
### 쿠폰 발급
```mermaid
sequenceDiagram
    autonumber
    actor 클라이언트
    participant 서비스
    participant 사용자
    participant 쿠폰
    participant 사용자 쿠폰
    participant 쿠폰이력
    클라이언트 ->>+ 서비스: 쿠폰 발급 요청
    서비스 ->>+ 사용자: 사용자 조회
    
    opt 사용자 존재 ❌
        사용자 -->> 클라이언트: 사용자 미존재 오류
    end
    사용자 ->>- 서비스: 사용자 조회 완료
    
    서비스 ->> 쿠폰: 쿠폰 조회
    opt 쿠폰 존재 ❌
        쿠폰 -->> 클라이언트: 쿠폰 미존재 오류
    end
    
    서비스 -->>- 클라이언트: 쿠폰 발급 요청 완료 ✅

```