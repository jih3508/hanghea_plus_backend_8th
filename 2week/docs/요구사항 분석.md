# 요구사항 분석 문서

## 목차
- 이커머스란?
- 요구사항
- 0️⃣ 공통
- 1️⃣ **잔액 충전 / 조회 API**

### ✳️ 이커머스란?
```text
전자 상거래(電子商去來, 영어: electronic commerce, e-commerce, eCommerce)는 컴퓨터 등을 이용해 인터넷과 같은 네트워크 상에서 이루어지는 즉, 전자적 매체(시스템)를 이용하여 가상 공간에서 이루어지는, 제품이나 용역을 사고 파는 거래행위이다.
```

### ✳️ 기본 요구사항

1️⃣ **잔액 충전 / 조회 API**  
2️⃣ **상품 조회 API**  
3️⃣ **선착순 쿠폰 기능**  
4️⃣ **주문 / 결제 API**  
5️⃣ **상위 상품 조회 API**  

### 0️⃣ 공통
▶️ 기능적 요구사항
- 사용자의 식별자 통해서 조회 하도록 해야한다.
- 없는 사용자이면 없다고 오류를 보내야한다.

▶️ 비기능적 요구사항
- 식별자를 DB PK ID값이 아닌 인증된 사용자(또는 로그인한 사용자)로 통해서 조회 되도록 해야 한다.
- 로그인또는 인증된 사용자는 세션에 저장하고 사용자 조회시 세션에 정보에서 가져오도록 처리한다.

### 1️⃣ **잔액 충전 / 조회 API**

#### #️⃣ 잔액 조회  
▶️ 기능적 요구사항
- 사용자의 식별자 통해서 잔액을 조회한다.
- 잔액이 없으면 0으로 출력한다.

#### #️⃣ 잔액 충전
▶️ 기능적 요구사항
- 잔액을 조회한다.
- 충전금액이 최소 1000원 이하면 실패 되도록한다.
- 충전 후 최대 보유 가능한 금액이 넘어 가면 충전 실패 되도록 한다.
- 잔액을 충전한다.
- 충전시 충전 이력을 남긴다.

▶️ 비기능적 요구사항
- 충전시 동시성 제어가 되어야 한다.

#### 2️⃣ **상품 조회 API**
▶️ 기능적 요구사항
- 조회시 상품에대한 기본적인 정보(상품 ID, 상품번호 ,상품명, 가격)를 가져온다.
- 상품에 대한 재고에 관한 정보도 가져온다.
- 상품에 대한 재고가 없으면 판매 안되도록 표시하는 정보 준다.

▶️ 비기능적 요구사항
- 주문시 상품에 대한 재고가 여러명이 출납이 가능 하기 때문에 재고에 대한 동시성 보장 되도록 한다.

#### 3️⃣ **선착순 쿠폰 기능**  

▶️ 기능적 요구사항
- 쿠폰 발급및 사용자가 보유하는 쿠폰 목록을 제공하는 기능을 제공한다.
- 쿠폰 기본정보
    - 쿠폰 사용기간
    - 쿠폰 할인 종류: 정액, 정률
    - 쿠폰 사용 가능 여부
    - 쿠폰 할인 금액

- 쿠폰 발급
    - 식별된 사용자한테 쿠폰 발급하도록 한다.
    - 발급하기 전에 보유수가 1개 미만 되면 안된다.
    - 쿠폰 보유수가 0개이면 발급 못하도록 막는다.
    - 발급시에 쿠폰만료기간이 오늘 이전이면 안된다.
    - 발급시 DB에는 사용자와 쿠폰에 관한 정보 테이블에 저장한다.
    - 같은 쿠폰 번호 저장 되지 못하도록 한다.
- 쿠폰 목록
    - 목록 출력시 각 쿠폰에 대한 정보를 제공한다. (쿠폰 번호, 쿠폰 만료기간, 할인 금액(정액, 정률), 사용여부)

▶️ 비기능적 요구사항
- 쿠폰 발급시에 동시성이 보장 되어야 한다.(순서대로 온 사람 발급가능, 0개 되면 발급 못하도록 한다.)
- 만약 동시에 발급자가 많을 요청 할 수 있어서 최대 요청 받는 수를 제한한다.


#### 4️⃣ **주문 / 결제 API**
▶️ 기능적 요구사항  
#️⃣ 주문
- 주문 목록에 각 상품과 수량을 받는다.
- 각 주문에 대한 상품에 대한 존재와 재고를 파악해서 주문 못한 상품이면 오류를 보낸다.
- 주문 목록에 각 상품과 수량에 따른 합계를 계산한다.
- 쿠폰 사용여부를 확인하고 쿠폰 사용 했으면 헙계에서 차감한다. 만약 차감한 금액이 합계 계산 보다 크면 0으로 계산 하도록 한다.
- 주문시 수량 만큼 재고에서 차감한다.
- 정상적으로 주문이 성공하면 주문정보에 각 상품에 대한 정보와 수량 이력을 저장한다.  

#️⃣ 결제
- 잔액을 조회한다.
- 잔액 조회시 주문 금액이 포인트 보다 작으면 오류를 보낸다.
- 결제시 잔액을 주문 금액 만큼 차감한다.
- 결제 실패시 주문 실패 되도록 처리한다.
- 결제 성공시 주문 이력과 잔액 사용 이력을 저장한다.
    
▶️ 비기능적 요구사항
- 주문과 결제에 대한 트랜잭션이 보장 되어야 한다.
- 재고와 사용자 잔액에 대한 동시성이 제어 되어야 한다.
- 결제 성공 시에 실시간으로 주문 정보를 데이터를 외부 플랫폼에 전송해야 합니다.

#### 5️⃣ **상위 상품 조회 API**  
▶️ 기능적 요구사항
- 최근 3일간 가장 많이 팔린 상위 5개 상품 정보를 제공해야 한다.
- 전체 주문 이력 관리하는 테이블에서 조회하지 말고 일별로 상품에 판매 수량을 저장 하는 테이블에서 조회 한다.

▶️ 비기능적 요구사항
- 일별로 주문한 상품과 수량을 기록하도록 배치와 스케줄러로 처리해서 일별로 상품에 판매 수량을 관리하는 테이블에 저장한다.


### ✳️ 추가 기능 구현 해야할것
▶️ 기능적 요구사항 
- #️⃣ **로그인**
- #️⃣ **회원가입**
- #️⃣ **잔액 환불처리**
- #️⃣ **상품 등록**
- #️⃣ **상품 정보 수정**
- #️⃣ **상품 재고 입고 처리**
- #️⃣ **주문 취소**

▶️ 비기능적적 요구사항 
- #️⃣ **사용자 인증 처리리**